# 部署到生产环境 - 快速指南

## ✅ 当前状态

- ✅ **前端已部署到 Vercel**
  - URL: https://decision-assistant-6a9f3h29e-bruces-projects-409b2d51.vercel.app
  - 状态：成功

- ⏳ **后端待部署**（下一步）

---

## 🚀 步骤 1：部署后端到 Render.com（免费）

### 1.1 注册并登录

1. 访问：https://render.com
2. 点击 "Get Started for Free"
3. 使用 GitHub 账号登录
4. 授权 Render 访问你的仓库

### 1.2 创建 Web Service

1. 点击右上角 "New +" 按钮
2. 选择 "Web Service"
3. 找到你的 `decision-assistant` 仓库，点击 "Connect"

### 1.3 配置服务

在配置页面填写：

```
Name: decision-assistant-backend
Region: Oregon (或选择离你最近的)
Branch: main (或你的默认分支)

Root Directory: backend
Runtime: Python 3
Build Command: pip install -r requirements.txt
Start Command: uvicorn app.main:app --host 0.0.0.0 --port $PORT
```

**Instance Type:** Free

点击 "Create Web Service"

### 1.4 等待部署

- 大约需要 3-5 分钟
- 可以在页面上看到实时日志
- 部署成功后，顶部会显示你的后端 URL

示例：`https://decision-assistant-backend.onrender.com`

**复制这个 URL，下一步会用到！**

---

## 🔧 步骤 2：配置前端连接后端

### 2.1 在 Vercel 添加环境变量

1. 访问：https://vercel.com/bruces-projects-409b2d51/decision-assistant
2. 点击 "Settings" 标签
3. 左侧选择 "Environment Variables"
4. 添加新变量：

```
Name: REACT_APP_API_URL
Value: https://your-backend-url.onrender.com
```

**⚠️ 重要：** 
- 将 `https://your-backend-url.onrender.com` 替换为你的实际 Render URL
- 不要在 URL 末尾加斜杠 `/`

5. Environments: 选择 "Production", "Preview", "Development"（全选）
6. 点击 "Save"

### 2.2 重新部署前端

环境变量保存后：
1. 点击 "Deployments" 标签
2. 找到最新的部署
3. 点击右侧的 "..." 菜单
4. 选择 "Redeploy"
5. 等待 1-2 分钟

或者在本地运行：
```bash
cd frontend
vercel --prod
```

---

## ✅ 步骤 3：测试生产环境

### 3.1 测试后端

在浏览器或使用 curl：

```bash
# 健康检查
curl https://your-backend-url.onrender.com/health

# 应该返回：
{"status":"healthy","service":"backend","ai":"DeepSeek"}
```

### 3.2 测试前端

1. 访问：https://decision-assistant-6a9f3h29e-bruces-projects-409b2d51.vercel.app
2. 等待页面加载
3. 尝试以下功能：
   - ✅ Decision Analysis（决策分析）
   - ✅ Chat Mode（聊天模式）
   - ✅ Chat Viewer（聊天查看器）

### 3.3 检查浏览器控制台

按 F12 打开开发者工具：
- **Console 标签：** 不应该有 CORS 错误
- **Network 标签：** API 请求应该返回 200 状态

---

## 🔍 常见问题

### Q1: Render 后端部署失败

**症状：** 部署日志显示错误

**解决：**
1. 检查 `backend/requirements.txt` 是否存在
2. 确认 Root Directory 设置为 `backend`
3. 查看错误日志，通常是依赖问题

### Q2: 前端连接后端失败

**症状：** 浏览器控制台显示 CORS 错误或网络错误

**解决：**
1. 确认 Vercel 环境变量配置正确
2. 确认后端 URL 没有多余的斜杠
3. 等待 2-3 分钟，Render 免费版第一次访问需要唤醒

### Q3: 后端很慢或超时

**症状：** 请求需要很长时间

**原因：** Render 免费版 15 分钟无活动会休眠

**解决：**
- 第一次访问需要 30-60 秒启动
- 后续访问会正常
- 或者升级到付费版（$7/月）

### Q4: Chat Viewer 显示空数据

**症状：** 聊天查看器显示"暂无聊天记录"

**原因：** 
- Render 的 chat_data 目录是空的
- 本地的聊天数据不会自动同步到服务器

**解决：**
- 使用 Chat Mode 创建一些聊天记录
- 或者手动上传 chat_data 文件到 Render（需要配置持久化存储）

---

## 📊 部署清单

完成后应该有：

- [x] 前端部署到 Vercel
  - URL: https://decision-assistant-6a9f3h29e-bruces-projects-409b2d51.vercel.app
  
- [ ] 后端部署到 Render
  - URL: https://_____.onrender.com
  
- [ ] Vercel 环境变量已配置
  - REACT_APP_API_URL 已设置
  
- [ ] 前端重新部署
  
- [ ] 测试通过
  - [ ] 后端健康检查
  - [ ] 前端界面加载
  - [ ] API 调用成功
  - [ ] 无 CORS 错误

---

## 🎯 完成标志

当你看到：

✅ **后端健康检查成功：**
```json
{"status":"healthy","service":"backend","ai":"DeepSeek"}
```

✅ **前端界面正常：**
- Decision Assistant 标题显示
- 三个模式按钮可用
- 点击 Chat Mode 可以发送消息
- 点击 Chat Viewer 可以查看记录

✅ **浏览器控制台：**
- 无红色错误
- Network 标签显示 API 请求成功

**🎉 恭喜！生产环境部署完成！**

---

## 📝 后续优化

### 可选：配置自定义域名

**Vercel（前端）：**
1. Settings → Domains
2. 添加你的域名
3. 配置 DNS

**Render（后端）：**
1. Settings → Custom Domains
2. 添加域名（需要付费版）

### 可选：持久化存储

Render 免费版重启会丢失数据。如需持久化：

1. 使用 Render Disks（付费）
2. 或使用外部存储（AWS S3, Google Cloud Storage）
3. 或使用数据库存储聊天记录

---

## 🆘 需要帮助？

### Render 支持
- 文档：https://render.com/docs
- 社区：https://community.render.com

### Vercel 支持
- 文档：https://vercel.com/docs
- 社区：https://github.com/vercel/vercel/discussions

### 项目文档
- 技术总结：`技术总结-第三方开发者.md`
- 快速启动：`快速启动指南.md`

---

**祝部署顺利！** 🚀

有问题随时查看文档或寻求帮助。

