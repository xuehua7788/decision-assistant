# 用户认证功能说明

## 功能概述

已成功为 Decision Assistant 添加了完整的用户认证系统，包括：
- ✅ 用户注册
- ✅ 用户登录
- ✅ 用户退出
- ✅ 会话保持（7天有效期）

## 新增文件

### 后端
1. `backend/app/models/database_models.py` - 添加了User模型
2. `backend/app/core/security.py` - JWT令牌和密码加密工具
3. `backend/app/routes/auth_routes.py` - 认证相关API路由
4. `backend/requirements.txt` - 添加了认证依赖包

### 前端
1. `frontend/src/Login.js` - 登录界面组件
2. `frontend/src/Register.js` - 注册界面组件
3. `frontend/src/App.js` - 更新以集成认证功能

## API接口

### 1. 用户注册
```
POST /api/auth/register
Content-Type: application/json

{
  "username": "用户名",
  "email": "email@example.com",
  "password": "密码（至少6个字符）"
}

响应：
{
  "username": "用户名",
  "email": "email@example.com",
  "token": "JWT令牌"
}
```

### 2. 用户登录
```
POST /api/auth/login
Content-Type: application/json

{
  "username": "用户名",
  "password": "密码"
}

响应：
{
  "username": "用户名",
  "email": "email@example.com",
  "token": "JWT令牌"
}
```

### 3. 用户退出
```
POST /api/auth/logout
Authorization: Bearer {token}

响应：
{
  "message": "退出成功"
}
```

### 4. 获取当前用户信息
```
GET /api/auth/me
Authorization: Bearer {token}

响应：
{
  "username": "用户名",
  "email": "email@example.com"
}
```

## 使用步骤

### 1. 安装依赖

在后端目录安装新的依赖：
```bash
cd backend
pip install -r requirements.txt
```

### 2. 启动应用

使用现有的启动脚本：
```bash
# Windows
.\start-dev.bat

# 或使用
start-app.bat
```

### 3. 使用流程

1. **首次使用 - 注册**
   - 打开应用，会看到登录界面
   - 点击"立即注册"
   - 填写用户名、邮箱和密码（至少6个字符）
   - 点击"注册"按钮
   - 注册成功后自动登录并进入主应用

2. **已有账户 - 登录**
   - 在登录界面输入用户名和密码
   - 点击"登录"按钮
   - 登录成功后进入主应用

3. **使用应用**
   - 登录后，右上角显示当前用户名
   - 可以正常使用决策分析和聊天功能
   - 会话会保持7天，无需频繁登录

4. **退出**
   - 点击右上角的"退出登录"按钮
   - 返回到登录界面

## 数据存储

- 用户数据存储在 `backend/users_data.json` 文件中
- 密码经过bcrypt加密，安全可靠
- JWT令牌有效期为7天

## 安全特性

✅ 密码加密存储（bcrypt）
✅ JWT令牌认证
✅ 邮箱格式验证
✅ 密码长度验证（至少6个字符）
✅ 用户名和邮箱唯一性检查

## 界面特色

- 🎨 现代化渐变背景
- 📱 响应式设计
- ✨ 友好的用户交互
- 🔐 清晰的错误提示
- 👤 右上角显示用户信息

## 后续改进建议

如果要在生产环境使用，建议：
1. 将 `backend/app/core/security.py` 中的 SECRET_KEY 改为环境变量
2. 使用真实数据库（如PostgreSQL、MySQL）替代JSON文件存储
3. 添加邮箱验证功能
4. 添加密码重置功能
5. 添加用户头像功能
6. 实现更细粒度的权限控制

## 问题排查

### 问题1：登录后立即退出
- 检查localStorage是否被清除
- 检查浏览器控制台是否有错误

### 问题2：无法连接到服务器
- 确保后端服务正在运行
- 检查API_URL配置是否正确

### 问题3：注册失败
- 检查用户名和邮箱是否已被使用
- 确保密码至少6个字符
- 确保邮箱格式正确


