# ğŸ” Decision Assistant - ç”¨æˆ·ç®¡ç†å’Œåˆ†ææ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

1. [å½“å‰é—®é¢˜](#å½“å‰é—®é¢˜)
2. [æ”¹è¿›æ–¹æ¡ˆ](#æ”¹è¿›æ–¹æ¡ˆ)
3. [å®ç°æ­¥éª¤](#å®ç°æ­¥éª¤)
4. [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
5. [ç”¨æˆ·åˆ†æåŠŸèƒ½](#ç”¨æˆ·åˆ†æåŠŸèƒ½)

---

## âš ï¸ å½“å‰é—®é¢˜

### é—®é¢˜ 1ï¼šæ— æ³•åŒºåˆ†ä¸åŒç”¨æˆ·

**å½“å‰æœºåˆ¶ï¼š**
- åªæœ‰ `session_id`ï¼ˆä¼šè¯IDï¼‰
- æ²¡æœ‰ `user_id`ï¼ˆç”¨æˆ·IDï¼‰
- æ— æ³•è¿½è¸ªåŒä¸€ç”¨æˆ·çš„å¤šæ¬¡å¯¹è¯

**ç¤ºä¾‹ï¼š**
```
ç”¨æˆ· A ç¬¬ä¸€æ¬¡è®¿é—® â†’ session_id: aaa-111
ç”¨æˆ· A ç¬¬äºŒæ¬¡è®¿é—® â†’ session_id: bbb-222  âŒ ç³»ç»Ÿä¸çŸ¥é“è¿™æ˜¯åŒä¸€ä¸ªäºº
ç”¨æˆ· B ç¬¬ä¸€æ¬¡è®¿é—® â†’ session_id: ccc-333
```

### é—®é¢˜ 2ï¼šèŠå¤©è®°å½•åˆ†æ•£

**å½“å‰å­˜å‚¨ï¼š**
```
chat_data/
â”œâ”€â”€ session-aaa.json  (ç”¨æˆ· A ç¬¬ä¸€æ¬¡)
â”œâ”€â”€ session-bbb.json  (ç”¨æˆ· A ç¬¬äºŒæ¬¡)
â””â”€â”€ session-ccc.json  (ç”¨æˆ· B)
```

æ— æ³•çŸ¥é“å“ªäº›ä¼šè¯å±äºåŒä¸€ä¸ªç”¨æˆ·ã€‚

### é—®é¢˜ 3ï¼šæ— æ³•è¿›è¡Œç”¨æˆ·çº§åˆ†æ

- âŒ æ— æ³•ç»Ÿè®¡æŸä¸ªç”¨æˆ·çš„æ€»å¯¹è¯æ¬¡æ•°
- âŒ æ— æ³•åˆ†æç”¨æˆ·çš„å†³ç­–åå¥½
- âŒ æ— æ³•æä¾›ä¸ªæ€§åŒ–å»ºè®®

---

## ğŸ’¡ æ”¹è¿›æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šç®€å•ç”¨æˆ·è¯†åˆ«ï¼ˆæ¨èå¼€å§‹ï¼‰

**æ·»åŠ ç”¨æˆ·æ ‡è¯†ï¼Œä¸éœ€è¦ç™»å½•**

**æœºåˆ¶ï¼š**
1. ç”¨æˆ·é¦–æ¬¡è®¿é—® â†’ ç”Ÿæˆ `user_id`ï¼Œä¿å­˜åˆ°æµè§ˆå™¨ Cookie/LocalStorage
2. ä¹‹åè®¿é—® â†’ è¯»å– `user_id`ï¼ŒæœåŠ¡å™¨è¯†åˆ«æ˜¯åŒä¸€ç”¨æˆ·
3. æ¯æ¬¡å¯¹è¯ â†’ åŒæ—¶è®°å½• `user_id` å’Œ `session_id`

**ä¼˜ç‚¹ï¼š**
- âœ… å®ç°ç®€å•
- âœ… æ— éœ€ç™»å½•æ³¨å†Œ
- âœ… å¯ä»¥è¿½è¸ªç”¨æˆ·è¡Œä¸º

**ç¼ºç‚¹ï¼š**
- âš ï¸ æ¢è®¾å¤‡/æ¸…é™¤ç¼“å­˜ä¼šä¸¢å¤±èº«ä»½
- âš ï¸ ä¸å¤Ÿå®‰å…¨

---

### æ–¹æ¡ˆ Bï¼šå®Œæ•´ç”¨æˆ·ç³»ç»Ÿï¼ˆç”Ÿäº§æ¨èï¼‰

**æ·»åŠ ç”¨æˆ·æ³¨å†Œ/ç™»å½•**

**æœºåˆ¶ï¼š**
1. ç”¨æˆ·æ³¨å†Œ â†’ åˆ›å»ºè´¦å·ï¼ˆé‚®ç®±/ç”¨æˆ·å + å¯†ç ï¼‰
2. ç”¨æˆ·ç™»å½• â†’ è·å¾— JWT Token
3. æ¯æ¬¡è¯·æ±‚ â†’ æºå¸¦ Tokenï¼ŒæœåŠ¡å™¨è¯†åˆ«ç”¨æˆ·
4. æ‰€æœ‰ä¼šè¯å…³è”åˆ°ç”¨æˆ·è´¦å·

**ä¼˜ç‚¹ï¼š**
- âœ… å®‰å…¨å¯é 
- âœ… è·¨è®¾å¤‡åŒæ­¥
- âœ… å¯ä»¥å®ç°æ›´å¤šåŠŸèƒ½ï¼ˆä¸ªäººä¸­å¿ƒã€æ•°æ®å¯¼å‡ºç­‰ï¼‰

**ç¼ºç‚¹ï¼š**
- âš ï¸ å®ç°å¤æ‚
- âš ï¸ éœ€è¦æ•°æ®åº“

---

## ğŸš€ å®ç°æ­¥éª¤

### é˜¶æ®µ 1ï¼šç®€å•ç”¨æˆ·è¯†åˆ«ï¼ˆæœ€å°æ”¹åŠ¨ï¼‰

#### æ­¥éª¤ 1ï¼šä¿®æ”¹æ•°æ®ç»“æ„

**æ–°çš„ä¼šè¯æ•°æ®ç»“æ„ï¼š**

```json
{
  "session_id": "04fd2aa5-9d5c-41b5-a0cc-0dc685380200",
  "user_id": "user-abc123",  // â† æ–°å¢
  "created_at": "2025-10-13T10:30:45.123456",
  "last_activity": "2025-10-13T11:45:20.654321",
  "messages": [...]
}
```

#### æ­¥éª¤ 2ï¼šä¿®æ”¹åç«¯ API

**æ·»åŠ  user_id å‚æ•°ï¼š**

```python
# backend/app/routes/decision_routes.py

class ChatMessage(BaseModel):
    message: str
    session_id: Optional[str] = None
    user_id: Optional[str] = None  # â† æ–°å¢

@router.post("/chat", response_model=ChatResponse)
async def chat_with_assistant(chat_message: ChatMessage):
    # è·å–æˆ–åˆ›å»º user_id
    user_id = chat_message.user_id or f"user-{str(uuid.uuid4())}"
    
    # è·å–æˆ–åˆ›å»º session_id
    session_id = chat_message.session_id or str(uuid.uuid4())
    
    # ä¿å­˜æ¶ˆæ¯æ—¶åŒ…å« user_id
    chat_storage.add_message(
        session_id=session_id,
        user_id=user_id,  # â† ä¼ å…¥ user_id
        role="user",
        content=chat_message.message
    )
    # ...
```

#### æ­¥éª¤ 3ï¼šä¿®æ”¹å‰ç«¯

**åœ¨æµè§ˆå™¨ä¿å­˜ user_idï¼š**

```javascript
// frontend/src/App.js

// åœ¨ç»„ä»¶é¡¶éƒ¨æ·»åŠ 
const [userId, setUserId] = useState(() => {
  // ä» localStorage è¯»å– user_id
  let uid = localStorage.getItem('decision_assistant_user_id');
  if (!uid) {
    // å¦‚æœæ²¡æœ‰ï¼Œç”Ÿæˆæ–°çš„
    uid = `user-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    localStorage.setItem('decision_assistant_user_id', uid);
  }
  return uid;
});

// å‘é€æ¶ˆæ¯æ—¶åŒ…å« user_id
const sendMessage = async () => {
  const response = await fetch(`${API_URL}/api/decisions/chat`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ 
      message: userMessage,
      user_id: userId  // â† åŒ…å« user_id
    })
  });
  // ...
};
```

#### æ­¥éª¤ 4ï¼šä¿®æ”¹å­˜å‚¨é€»è¾‘

```python
# backend/app/services/chat_storage.py

def add_message(self, session_id: str, user_id: str, role: str, content: str) -> None:
    """æ·»åŠ æ¶ˆæ¯åˆ°ä¼šè¯"""
    file_path = self.storage_dir / f"{session_id}.json"
    
    if file_path.exists():
        with open(file_path, 'r', encoding='utf-8') as f:
            data = json.load(f)
    else:
        data = {
            "session_id": session_id,
            "user_id": user_id,  # â† ä¿å­˜ user_id
            "created_at": datetime.now().isoformat(),
            "messages": []
        }
    
    # æ·»åŠ æ¶ˆæ¯...
```

---

### é˜¶æ®µ 2ï¼šæ·»åŠ ç”¨æˆ·åˆ†æåŠŸèƒ½

#### æ–°å¢ APIï¼šè·å–ç”¨æˆ·æ‰€æœ‰ä¼šè¯

```python
# backend/app/routes/decision_routes.py

@router.get("/user/{user_id}/sessions")
async def get_user_sessions(user_id: str):
    """è·å–ç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰ä¼šè¯"""
    all_sessions = chat_storage.get_all_sessions()
    
    # è¿‡æ»¤å‡ºè¯¥ç”¨æˆ·çš„ä¼šè¯
    user_sessions = [
        session for session in all_sessions 
        if session.get('user_id') == user_id
    ]
    
    return {
        "user_id": user_id,
        "total_sessions": len(user_sessions),
        "sessions": user_sessions
    }
```

#### æ–°å¢ APIï¼šåˆ†æç”¨æˆ·è¡Œä¸º

```python
@router.get("/user/{user_id}/analysis")
async def analyze_user_behavior(user_id: str):
    """åˆ†æç”¨æˆ·çš„å†³ç­–åå¥½å’Œè¡Œä¸ºæ¨¡å¼"""
    all_sessions = chat_storage.get_all_sessions()
    user_sessions = [
        s for s in all_sessions 
        if s.get('user_id') == user_id
    ]
    
    if not user_sessions:
        raise HTTPException(status_code=404, detail="User not found")
    
    # ç»Ÿè®¡åˆ†æ
    total_messages = sum(s.get('message_count', 0) for s in user_sessions)
    
    # è·å–æ‰€æœ‰æ¶ˆæ¯å†…å®¹
    all_messages = []
    for session_summary in user_sessions:
        session_data = chat_storage.get_session(session_summary['session_id'])
        if session_data:
            all_messages.extend(session_data.get('messages', []))
    
    # æå–ç”¨æˆ·æ¶ˆæ¯
    user_messages = [
        msg['content'] for msg in all_messages 
        if msg['role'] == 'user'
    ]
    
    # ä½¿ç”¨ AI åˆ†æç”¨æˆ·åå¥½
    analysis_prompt = f"""
    åˆ†æä»¥ä¸‹ç”¨æˆ·çš„å†å²å¯¹è¯è®°å½•ï¼Œæ€»ç»“ç”¨æˆ·çš„ï¼š
    1. ä¸»è¦å…³æ³¨çš„å†³ç­–ç±»å‹ï¼ˆèŒä¸šã€è´¢åŠ¡ã€ç”Ÿæ´»ç­‰ï¼‰
    2. å†³ç­–é£æ ¼ï¼ˆç†æ€§ã€æ„Ÿæ€§ã€é£é™©åå¥½ç­‰ï¼‰
    3. å¸¸è§çš„å›°æƒ‘å’Œéœ€æ±‚
    4. å»ºè®®çš„å†³ç­–è¾…åŠ©æ–¹å‘
    
    ç”¨æˆ·å†å²æ¶ˆæ¯ï¼š
    {chr(10).join(user_messages[:20])}  # å–å‰20æ¡
    """
    
    ai_analysis = ai_service.get_response(analysis_prompt)
    
    return {
        "user_id": user_id,
        "statistics": {
            "total_sessions": len(user_sessions),
            "total_messages": total_messages,
            "first_activity": min(s['created_at'] for s in user_sessions),
            "last_activity": max(s.get('last_activity', s['created_at']) for s in user_sessions)
        },
        "ai_analysis": ai_analysis,
        "sample_messages": user_messages[:5]  # ç¤ºä¾‹æ¶ˆæ¯
    }
```

#### æ–°å¢ APIï¼šåŸºäºå†å²çš„ä¸ªæ€§åŒ–å›å¤

```python
@router.post("/chat-personalized")
async def chat_with_personalization(chat_message: ChatMessage):
    """åŸºäºç”¨æˆ·å†å²çš„ä¸ªæ€§åŒ–èŠå¤©"""
    user_id = chat_message.user_id
    
    # è·å–ç”¨æˆ·å†å²
    user_sessions = get_user_sessions_internal(user_id)
    
    # æ„å»ºä¸ªæ€§åŒ–ä¸Šä¸‹æ–‡
    personalized_context = f"""
    ç”¨æˆ·å†å²æ¦‚å†µï¼š
    - æ€»å¯¹è¯æ¬¡æ•°ï¼š{len(user_sessions)}
    - æœ€è¿‘å…³æ³¨ï¼š[æ ¹æ®å†å²æ¶ˆæ¯æå–]
    - å†³ç­–åå¥½ï¼š[æ ¹æ®å†å²åˆ†æ]
    """
    
    # è·å– AI å›å¤æ—¶åŠ å…¥ä¸ªæ€§åŒ–ä¸Šä¸‹æ–‡
    ai_response = ai_service.get_response(
        chat_message.message, 
        context=personalized_context
    )
    
    return {
        "response": ai_response,
        "personalized": True
    }
```

---

## ğŸ“ å®Œæ•´ä»£ç ç¤ºä¾‹

### 1. ä¿®æ”¹åç«¯å­˜å‚¨

**æ–‡ä»¶ï¼š`backend/app/services/chat_storage.py`**

```python
# åœ¨åŸæœ‰ä»£ç åŸºç¡€ä¸Šä¿®æ”¹

def add_message(self, session_id: str, user_id: str, role: str, content: str) -> None:
    """æ·»åŠ æ¶ˆæ¯åˆ°ä¼šè¯ï¼ˆæ”¯æŒ user_idï¼‰"""
    file_path = self.storage_dir / f"{session_id}.json"
    
    if file_path.exists():
        with open(file_path, 'r', encoding='utf-8') as f:
            data = json.load(f)
    else:
        data = {
            "session_id": session_id,
            "user_id": user_id,  # æ–°å¢
            "created_at": datetime.now().isoformat(),
            "messages": []
        }
    
    data["messages"].append({
        "role": role,
        "content": content,
        "timestamp": datetime.now().isoformat()
    })
    
    data["last_activity"] = datetime.now().isoformat()
    
    with open(file_path, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

def get_user_sessions(self, user_id: str) -> List[Dict]:
    """è·å–ç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰ä¼šè¯"""
    all_sessions = self.get_all_sessions()
    return [s for s in all_sessions if s.get('user_id') == user_id]
```

### 2. ä¿®æ”¹å‰ç«¯ App.js

**æ–‡ä»¶ï¼š`frontend/src/App.js`**

```javascript
// åœ¨ç»„ä»¶é¡¶éƒ¨æ·»åŠ 
import React, { useState, useEffect } from 'react';

function App() {
  // åˆå§‹åŒ– user_id
  const [userId, setUserId] = useState(() => {
    let uid = localStorage.getItem('decision_assistant_user_id');
    if (!uid) {
      uid = `user-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      localStorage.setItem('decision_assistant_user_id', uid);
      console.log('æ–°ç”¨æˆ·åˆ›å»º:', uid);
    } else {
      console.log('å·²æœ‰ç”¨æˆ·:', uid);
    }
    return uid;
  });

  // æ˜¾ç¤ºå½“å‰ç”¨æˆ·IDï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰
  useEffect(() => {
    console.log('å½“å‰ç”¨æˆ·ID:', userId);
  }, [userId]);

  // ä¿®æ”¹ sendMessage å‡½æ•°
  const sendMessage = async () => {
    if (!chatInput.trim()) return;

    setChatMessages([...chatMessages, { type: 'user', text: chatInput }]);
    const userMessage = chatInput;
    setChatInput('');

    try {
      const response = await fetch(`${API_URL}/api/decisions/chat`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          message: userMessage,
          user_id: userId  // â† æ·»åŠ  user_id
        })
      });
      
      const data = await response.json();
      setChatMessages(prev => [...prev, { type: 'assistant', text: data.response }]);
    } catch (error) {
      setChatMessages(prev => [...prev, { 
        type: 'assistant', 
        text: 'Error: Could not connect to server' 
      }]);
    }
  };

  // ... å…¶ä»–ä»£ç 
}
```

### 3. æ·»åŠ ç”¨æˆ·ç®¡ç†é¡µé¢

**æ–°æ–‡ä»¶ï¼š`frontend/src/UserProfile.js`**

```javascript
import React, { useState, useEffect } from 'react';

function UserProfile() {
  const [userId, setUserId] = useState('');
  const [userStats, setUserStats] = useState(null);
  const [analysis, setAnalysis] = useState(null);

  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';

  useEffect(() => {
    // è·å–å½“å‰ç”¨æˆ·ID
    const uid = localStorage.getItem('decision_assistant_user_id');
    setUserId(uid);
    if (uid) {
      fetchUserData(uid);
    }
  }, []);

  const fetchUserData = async (uid) => {
    try {
      // è·å–ç”¨æˆ·ç»Ÿè®¡
      const statsResponse = await fetch(`${API_URL}/api/decisions/user/${uid}/sessions`);
      const statsData = await statsResponse.json();
      setUserStats(statsData);

      // è·å–AIåˆ†æ
      const analysisResponse = await fetch(`${API_URL}/api/decisions/user/${uid}/analysis`);
      const analysisData = await analysisResponse.json();
      setAnalysis(analysisData);
    } catch (error) {
      console.error('è·å–ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
    }
  };

  return (
    <div style={{ padding: '20px' }}>
      <h1>ğŸ‘¤ ç”¨æˆ·èµ„æ–™</h1>
      
      <div style={{ background: '#f5f5f5', padding: '20px', borderRadius: '10px', marginBottom: '20px' }}>
        <h2>åŸºæœ¬ä¿¡æ¯</h2>
        <p><strong>ç”¨æˆ·ID:</strong> {userId}</p>
      </div>

      {userStats && (
        <div style={{ background: '#e3f2fd', padding: '20px', borderRadius: '10px', marginBottom: '20px' }}>
          <h2>ğŸ“Š ä½¿ç”¨ç»Ÿè®¡</h2>
          <p><strong>æ€»ä¼šè¯æ•°:</strong> {userStats.total_sessions}</p>
          <div>
            <h3>ä¼šè¯åˆ—è¡¨</h3>
            {userStats.sessions.map((session, index) => (
              <div key={session.session_id} style={{ 
                padding: '10px', 
                margin: '10px 0', 
                background: 'white', 
                borderRadius: '5px' 
              }}>
                <p><strong>ä¼šè¯ #{index + 1}</strong></p>
                <p>æ¶ˆæ¯æ•°: {session.message_count}</p>
                <p>æ—¶é—´: {new Date(session.created_at).toLocaleString()}</p>
              </div>
            ))}
          </div>
        </div>
      )}

      {analysis && (
        <div style={{ background: '#f3e5f5', padding: '20px', borderRadius: '10px' }}>
          <h2>ğŸ¤– AI ä¸ªæ€§åŒ–åˆ†æ</h2>
          <div style={{ whiteSpace: 'pre-wrap', lineHeight: '1.6' }}>
            {analysis.ai_analysis}
          </div>
        </div>
      )}
    </div>
  );
}

export default UserProfile;
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1ï¼šè¿½è¸ªç”¨æˆ·è¡Œä¸º

```javascript
// å‰ç«¯å‘é€æ¶ˆæ¯æ—¶è‡ªåŠ¨åŒ…å« user_id
{
  "message": "æˆ‘æƒ³æ¢å·¥ä½œ",
  "user_id": "user-1697123456-abc123"
}

// åç«¯å­˜å‚¨æ—¶å…³è”åˆ°ç”¨æˆ·
{
  "session_id": "xxx",
  "user_id": "user-1697123456-abc123",  // å…³è”
  "messages": [...]
}
```

### åœºæ™¯ 2ï¼šæŸ¥çœ‹ç”¨æˆ·æ‰€æœ‰å¯¹è¯

```bash
# API è¯·æ±‚
GET /api/decisions/user/user-1697123456-abc123/sessions

# è¿”å›
{
  "user_id": "user-1697123456-abc123",
  "total_sessions": 5,
  "sessions": [
    {"session_id": "aaa", "message_count": 10, "created_at": "..."},
    {"session_id": "bbb", "message_count": 8, "created_at": "..."},
    ...
  ]
}
```

### åœºæ™¯ 3ï¼šåˆ†æç”¨æˆ·åå¥½

```bash
# API è¯·æ±‚
GET /api/decisions/user/user-1697123456-abc123/analysis

# è¿”å›
{
  "user_id": "user-1697123456-abc123",
  "statistics": {
    "total_sessions": 5,
    "total_messages": 45
  },
  "ai_analysis": "
    è¯¥ç”¨æˆ·ä¸»è¦å…³æ³¨èŒä¸šå‘å±•ç›¸å…³çš„å†³ç­–ï¼Œè¡¨ç°å‡ºä»¥ä¸‹ç‰¹ç‚¹ï¼š
    1. å†³ç­–é£æ ¼åå‘ç†æ€§åˆ†æ
    2. æ³¨é‡é•¿æœŸè§„åˆ’
    3. å¯¹é£é™©æŒè°¨æ…æ€åº¦
    å»ºè®®ï¼šæä¾›æ›´å¤šæ•°æ®æ”¯æŒå’Œå¤šè§’åº¦åˆ†æ
  "
}
```

### åœºæ™¯ 4ï¼šä¸ªæ€§åŒ–å›å¤

```python
# ç”¨æˆ·ç¬¬ä¸€æ¬¡é—®
"æˆ‘è¦ä¸è¦æ¢å·¥ä½œï¼Ÿ"
# AI å›å¤ï¼šé€šç”¨å»ºè®®

# ç”¨æˆ·ç¬¬äº”æ¬¡é—®ï¼ˆç³»ç»Ÿå·²æœ‰å†å²ï¼‰
"æˆ‘è¦ä¸è¦æ¢å·¥ä½œï¼Ÿ"
# AI å›å¤ï¼š
"æ ¹æ®ä½ ä¹‹å‰çš„å’¨è¯¢ï¼Œä½ æ¯”è¾ƒå…³æ³¨èŒä¸šç¨³å®šæ€§å’Œé•¿æœŸå‘å±•ã€‚
ç»“åˆä½ çš„å†å²å€¾å‘ï¼Œå»ºè®®ä½ é‡ç‚¹è€ƒè™‘..."
```

---

## ğŸ“Š æ•°æ®å­˜å‚¨å¯¹æ¯”

### æ”¹è¿›å‰

```
chat_data/
â”œâ”€â”€ session-aaa.json  {"session_id": "aaa", "messages": [...]}
â”œâ”€â”€ session-bbb.json  {"session_id": "bbb", "messages": [...]}
â””â”€â”€ session-ccc.json  {"session_id": "ccc", "messages": [...]}

âŒ æ— æ³•çŸ¥é“å“ªäº›ä¼šè¯å±äºåŒä¸€ç”¨æˆ·
```

### æ”¹è¿›å

```
chat_data/
â”œâ”€â”€ session-aaa.json  {"session_id": "aaa", "user_id": "user-123", ...}
â”œâ”€â”€ session-bbb.json  {"session_id": "bbb", "user_id": "user-123", ...}
â””â”€â”€ session-ccc.json  {"session_id": "ccc", "user_id": "user-456", ...}

âœ… å¯ä»¥æŒ‰ user_id æŸ¥è¯¢å’Œåˆ†æ
```

---

## ğŸ” éšç§å’Œå®‰å…¨è€ƒè™‘

### ç®€å•æ–¹æ¡ˆï¼ˆuser_idï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… æ— éœ€æ³¨å†Œï¼Œç”¨æˆ·ä½“éªŒå¥½
- âœ… å®ç°ç®€å•

**ç¼ºç‚¹ï¼š**
- âš ï¸ user_id å­˜å‚¨åœ¨ localStorageï¼Œå¯è¢«è¯»å–
- âš ï¸ æ¢è®¾å¤‡ä¼šç”Ÿæˆæ–° ID
- âš ï¸ æ¸…é™¤ç¼“å­˜ä¼šä¸¢å¤±èº«ä»½

**é€‚ç”¨åœºæ™¯ï¼š**
- ä¸ªäººä½¿ç”¨
- å†…éƒ¨å·¥å…·
- ä¸æ¶‰åŠæ•æ„Ÿä¿¡æ¯

### å®Œæ•´æ–¹æ¡ˆï¼ˆç™»å½•ç³»ç»Ÿï¼‰

**éœ€è¦æ·»åŠ ï¼š**
1. ç”¨æˆ·æ³¨å†Œ/ç™»å½•
2. JWT Token è®¤è¯
3. å¯†ç åŠ å¯†
4. æ•°æ®åº“å­˜å‚¨

**é€‚ç”¨åœºæ™¯ï¼š**
- å…¬å¼€éƒ¨ç½²
- å¤šäººä½¿ç”¨
- éœ€è¦å®‰å…¨ä¿éšœ

---

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### é˜¶æ®µ 1ï¼šåŸºç¡€ç”¨æˆ·è¯†åˆ«

- [ ] ä¿®æ”¹ `chat_storage.py` æ·»åŠ  `user_id` å‚æ•°
- [ ] ä¿®æ”¹ `decision_routes.py` API æ¥å— `user_id`
- [ ] ä¿®æ”¹ `App.js` ç”Ÿæˆå’Œå‘é€ `user_id`
- [ ] æµ‹è¯•ï¼šç¡®è®¤æ–°ä¼šè¯åŒ…å« `user_id`

### é˜¶æ®µ 2ï¼šç”¨æˆ·æŸ¥è¯¢åŠŸèƒ½

- [ ] æ·»åŠ  `/user/{user_id}/sessions` API
- [ ] æµ‹è¯•ï¼šèƒ½è·å–ç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰ä¼šè¯

### é˜¶æ®µ 3ï¼šç”¨æˆ·åˆ†æåŠŸèƒ½

- [ ] æ·»åŠ  `/user/{user_id}/analysis` API
- [ ] å®ç° AI åˆ†æé€»è¾‘
- [ ] æµ‹è¯•ï¼šèƒ½ç”Ÿæˆç”¨æˆ·è¡Œä¸ºåˆ†ææŠ¥å‘Š

### é˜¶æ®µ 4ï¼šå‰ç«¯å±•ç¤º

- [ ] åˆ›å»º `UserProfile.js` ç”¨æˆ·èµ„æ–™é¡µ
- [ ] åœ¨ä¸»ç•Œé¢æ·»åŠ "æˆ‘çš„èµ„æ–™"å…¥å£
- [ ] æ˜¾ç¤ºç”¨æˆ·ç»Ÿè®¡å’ŒAIåˆ†æ

### é˜¶æ®µ 5ï¼šä¸ªæ€§åŒ–åŠŸèƒ½

- [ ] å®ç°åŸºäºå†å²çš„ä¸ªæ€§åŒ–å›å¤
- [ ] æµ‹è¯•ï¼šæ–°è€ç”¨æˆ·å›å¤æœ‰å·®å¼‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€å°æ”¹åŠ¨æ–¹æ¡ˆï¼ˆ1å°æ—¶å†…å®Œæˆï¼‰

åªéœ€ä¿®æ”¹ 3 ä¸ªæ–‡ä»¶ï¼š

1. **`backend/app/services/chat_storage.py`** - æ·»åŠ  `user_id` å‚æ•°
2. **`backend/app/routes/decision_routes.py`** - æ¥æ”¶å’Œä¼ é€’ `user_id`
3. **`frontend/src/App.js`** - ç”Ÿæˆå’Œå‘é€ `user_id`

å®Œæˆåï¼š
- âœ… æ¯ä¸ªä¼šè¯å…³è”åˆ°ç”¨æˆ·
- âœ… å¯ä»¥è¿½è¸ªç”¨æˆ·è¡Œä¸º
- âœ… ä¸ºåç»­åˆ†ææ‰“åŸºç¡€

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2025-10-13  
**é€‚ç”¨åœºæ™¯ï¼š** å¤šç”¨æˆ·ç®¡ç†å’Œä¸ªæ€§åŒ–åˆ†æ



