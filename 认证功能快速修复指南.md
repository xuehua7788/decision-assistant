# 🔧 认证功能快速修复指南

## 问题原因

CORS 错误的原因是后端服务没有正确启动或认证路由没有加载。我已经在 Flask 版本的后端 (`backend/app.py`) 中添加了认证功能。

## ✅ 解决步骤

### 方法 1: 重启服务（推荐）

1. **关闭所有后端和前端窗口**

2. **重新安装后端依赖**
   ```bash
   cd backend
   pip install -r requirements.txt
   ```
   
   这会安装新添加的认证依赖：
   - `passlib[bcrypt]` - 密码加密
   - `python-jose[cryptography]` - JWT 令牌
   - `sqlalchemy` - 数据库支持

3. **重新启动应用**
   ```bash
   # 回到项目根目录
   cd ..
   
   # 使用启动脚本
   .\start-app.bat
   ```

### 方法 2: 手动启动

如果自动启动脚本有问题，可以手动启动：

1. **启动后端（新窗口）**
   ```bash
   cd backend
   pip install -r requirements.txt
   python app.py
   ```
   
   看到这样的输出表示成功：
   ```
   ==================================================
     Decision Assistant Backend (Flask)
   ==================================================
     🚀 Server starting on http://127.0.0.1:8000
     📚 API Endpoints:
        - POST /api/auth/register  (用户注册)
        - POST /api/auth/login     (用户登录)
        - POST /api/auth/logout    (用户退出)
        - GET  /api/auth/me        (获取用户信息)
   ==================================================
   ```

2. **测试后端（新窗口）**
   ```bash
   # 在项目根目录
   python test-auth-api.py
   ```
   
   这个脚本会测试所有认证端点是否正常工作。

3. **启动前端（新窗口）**
   ```bash
   cd frontend
   npm start
   ```

## 🧪 验证修复

打开浏览器访问 http://localhost:3000

你应该能看到：
- ✅ 登录界面正常显示
- ✅ 没有 CORS 错误
- ✅ 可以注册新用户
- ✅ 可以登录

## 📝 测试账号

如果想快速测试，可以使用测试脚本创建的账号：
- 用户名: `testuser`
- 密码: `password123`

或者直接注册新账号：
1. 点击"立即注册"
2. 填写用户名、邮箱、密码（至少6个字符）
3. 点击"注册"按钮

## ❓ 常见问题

### 问题1: 仍然出现 CORS 错误
**解决方案：**
- 确保后端已经完全重启
- 确保后端运行在 `http://127.0.0.1:8000`
- 检查后端控制台是否显示了新的 API 端点列表

### 问题2: 端口被占用
**解决方案：**
```bash
# Windows - 查找占用端口的进程
netstat -ano | findstr :8000

# 关闭占用的进程
taskkill /PID <进程ID> /F
```

### 问题3: 依赖安装失败
**解决方案：**
```bash
# 升级 pip
python -m pip install --upgrade pip

# 重新安装依赖
cd backend
pip install -r requirements.txt --force-reinstall
```

### 问题4: 导入错误（ImportError）
**解决方案：**
确保你在 `backend` 目录下安装了依赖：
```bash
cd backend
pip install passlib[bcrypt]
pip install python-jose[cryptography]
pip install sqlalchemy
```

## 🎯 完整的 API 端点列表

后端启动后，以下端点应该可用：

### 认证相关
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户退出
- `GET /api/auth/me` - 获取当前用户信息

### 决策相关
- `POST /api/decisions/chat` - 聊天对话
- `POST /api/decisions/analyze` - 决策分析
- `GET /health` - 健康检查

## 🔍 调试技巧

1. **查看后端日志**
   - 后端窗口会显示所有请求
   - 如果有错误会显示详细的堆栈跟踪

2. **使用浏览器开发者工具**
   - F12 打开开发者工具
   - Network 标签查看请求详情
   - Console 标签查看错误信息

3. **运行测试脚本**
   ```bash
   python test-auth-api.py
   ```
   这会测试所有认证端点

## 📞 还是不行？

如果按照上述步骤仍然无法解决，请提供：
1. 后端控制台的完整输出
2. 浏览器控制台的错误信息
3. `python test-auth-api.py` 的输出结果

这样我可以更准确地帮你定位问题！


