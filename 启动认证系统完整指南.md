# 🚀 启动认证系统完整指南

## 📋 目录
1. [快速启动（推荐）](#快速启动推荐)
2. [手动启动](#手动启动)
3. [验证系统](#验证系统)
4. [使用指南](#使用指南)
5. [常见问题](#常见问题)

---

## 🎯 快速启动（推荐）

### 方式 1: 一键启动脚本
```bash
.\快速启动认证版本.bat
```

这个脚本会自动：
- ✅ 安装所有必需的依赖
- ✅ 启动后端服务（端口 8000）
- ✅ 测试 API 是否正常
- ✅ 启动前端服务（端口 3000）
- ✅ 自动打开浏览器

### 方式 2: 使用原始启动脚本

1. **第一步：安装后端依赖**
   ```bash
   cd backend
   pip install -r requirements.txt
   cd ..
   ```

2. **第二步：创建前端环境配置**
   ```bash
   .\setup-frontend-env.bat
   ```

3. **第三步：启动服务**
   ```bash
   .\start-app.bat
   ```

---

## 🔧 手动启动

如果自动脚本有问题，可以按以下步骤手动启动：

### 步骤 1: 安装后端依赖

打开命令行窗口 1：
```bash
cd backend
pip install -r requirements.txt
```

确保这些包已安装：
- ✅ `passlib[bcrypt]` - 密码加密
- ✅ `python-jose[cryptography]` - JWT 令牌
- ✅ `sqlalchemy` - 数据库支持
- ✅ `flask` - Web 框架
- ✅ `flask-cors` - 跨域支持

### 步骤 2: 启动后端

在命令行窗口 1 中继续：
```bash
python app.py
```

你应该看到：
```
==================================================
  Decision Assistant Backend (Flask)
==================================================
  🚀 Server starting on http://127.0.0.1:8000
  📚 API Endpoints:
     - POST /api/auth/register  (用户注册)
     - POST /api/auth/login     (用户登录)
     - POST /api/auth/logout    (用户退出)
     - GET  /api/auth/me        (获取用户信息)
     - POST /api/decisions/chat (聊天)
     - POST /api/decisions/analyze (决策分析)
==================================================

 * Running on http://127.0.0.1:8000
```

### 步骤 3: 测试后端（可选但推荐）

打开新的命令行窗口 2：
```bash
python test-auth-api.py
```

如果所有测试通过，继续下一步。

### 步骤 4: 启动前端

打开新的命令行窗口 3：
```bash
cd frontend
npm start
```

等待编译完成，浏览器会自动打开 http://localhost:3000

---

## ✅ 验证系统

### 1. 检查后端

访问：http://127.0.0.1:8000/health

应该看到：
```json
{"status": "ok"}
```

### 2. 检查前端

访问：http://localhost:3000

应该看到：
- ✅ 登录界面正常显示
- ✅ 没有 CORS 错误（F12 打开控制台检查）
- ✅ 美观的紫色渐变背景

### 3. 测试认证功能

运行测试脚本：
```bash
python test-auth-api.py
```

应该看到：
```
==================================================
  测试 Decision Assistant 认证 API
==================================================

1️⃣  测试服务器连接...
   ✅ 服务器运行正常

2️⃣  测试注册端点...
   ✅ 注册端点正常

3️⃣  测试登录端点...
   ✅ 登录端点正常

4️⃣  测试获取用户信息...
   ✅ 用户信息端点正常
```

---

## 📖 使用指南

### 首次使用 - 注册账号

1. 访问 http://localhost:3000
2. 看到登录页面，点击底部的 **"立即注册"**
3. 填写注册信息：
   - **用户名**：任意用户名（唯一）
   - **邮箱**：有效的邮箱格式
   - **密码**：至少 6 个字符
   - **确认密码**：与密码相同
4. 点击 **"注册"** 按钮
5. 注册成功后自动登录，进入主应用

### 登录已有账号

1. 在登录页面输入用户名和密码
2. 点击 **"登录"** 按钮
3. 登录成功后进入主应用

### 使用主应用

登录后你会看到：
- 🎨 **顶部**：显示欢迎信息和用户名
- 🔐 **右上角**：退出登录按钮
- 📊 **主界面**：决策分析和聊天功能

### 退出登录

点击右上角的 **"🚪 退出登录"** 按钮

---

## ❓ 常见问题

### Q1: CORS 错误 - "blocked by CORS policy"

**症状**：
```
Access to fetch at 'http://127.0.0.1:8000/api/auth/login' 
from origin 'http://localhost:3000' has been blocked by CORS policy
```

**解决方案**：

**方案 A（推荐）：** 重启后端
1. 关闭后端窗口
2. 重新运行：
   ```bash
   cd backend
   python app.py
   ```
3. 确认看到所有 API 端点列表
4. 刷新前端页面

**方案 B：** 使用代理
1. 确保 `frontend/package.json` 包含：
   ```json
   "proxy": "http://127.0.0.1:8000"
   ```
2. 重启前端服务

**方案 C：** 清除缓存
1. Ctrl+Shift+R 强制刷新浏览器
2. 或清除浏览器缓存后重试

### Q2: 端口被占用

**症状**：
```
Error: listen EADDRINUSE: address already in use :::8000
```

**解决方案**：
```bash
# Windows - 查找并关闭占用端口的进程
netstat -ano | findstr :8000
taskkill /PID <进程ID> /F

# 或者使用不同端口
# 修改 backend/app.py 最后一行：
# app.run(debug=True, port=8001)
```

### Q3: 模块导入错误

**症状**：
```
ModuleNotFoundError: No module named 'passlib'
```

**解决方案**：
```bash
cd backend
pip install passlib[bcrypt] python-jose[cryptography] sqlalchemy
```

### Q4: 注册/登录按钮无反应

**可能原因和解决方案**：

1. **后端未启动**
   - 检查后端窗口是否在运行
   - 访问 http://127.0.0.1:8000/health 确认

2. **API URL 配置错误**
   - 检查前端代码中的 API_URL
   - 应该是 `http://127.0.0.1:8000` 或使用环境变量

3. **浏览器缓存**
   - 按 F12 打开控制台
   - 右键刷新按钮，选择"清空缓存并硬性重新加载"

### Q5: 注册成功但无法登录

**解决方案**：
1. 检查 `backend/users_data.json` 文件
2. 确认用户已被创建
3. 尝试注册一个新用户
4. 或运行测试脚本验证 API：
   ```bash
   python test-auth-api.py
   ```

### Q6: 前端一直显示加载中

**解决方案**：
1. 检查前端控制台（F12）的错误信息
2. 确认后端正在运行
3. 检查网络请求是否成功（F12 -> Network）
4. 尝试重启前端服务

---

## 🗂️ 文件结构

### 用户数据存储
```
backend/users_data.json
```
这个文件存储所有注册用户的信息（密码已加密）。

### 重要配置文件
```
backend/app.py              # 后端主文件（包含认证路由）
backend/requirements.txt    # 后端依赖
frontend/package.json       # 前端配置（包含 proxy）
frontend/src/App.js         # 前端主组件
frontend/src/Login.js       # 登录组件
frontend/src/Register.js    # 注册组件
```

---

## 🔐 安全特性

现在系统包含以下安全特性：

✅ **密码加密**：使用 bcrypt 算法加密存储
✅ **JWT 令牌**：安全的身份验证机制
✅ **令牌过期**：7 天自动过期
✅ **输入验证**：邮箱格式、密码长度等
✅ **唯一性检查**：用户名和邮箱不能重复
✅ **CORS 配置**：只允许指定来源访问

---

## 📊 API 端点文档

### 认证相关

#### 1. 注册
```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "myusername",
  "email": "user@example.com",
  "password": "password123"
}

响应：
{
  "username": "myusername",
  "email": "user@example.com",
  "token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
}
```

#### 2. 登录
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "myusername",
  "password": "password123"
}

响应：
{
  "username": "myusername",
  "email": "user@example.com",
  "token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
}
```

#### 3. 获取用户信息
```http
GET /api/auth/me
Authorization: Bearer {token}

响应：
{
  "username": "myusername",
  "email": "user@example.com"
}
```

#### 4. 退出
```http
POST /api/auth/logout
Authorization: Bearer {token}

响应：
{
  "message": "退出成功"
}
```

---

## 🎨 界面预览

### 登录界面
- 🎨 紫色渐变背景
- 📝 用户名和密码输入
- 🔗 注册链接
- ⚠️ 错误提示

### 注册界面
- 📝 用户名、邮箱、密码、确认密码输入
- ✅ 实时验证
- 🔗 登录链接
- ⚠️ 错误提示

### 主应用界面
- 👤 显示当前用户名
- 🚪 退出按钮
- 📊 决策分析功能
- 💬 聊天功能

---

## 💡 下一步

系统已经完全可用！你可以：

1. ✅ 注册测试账号
2. ✅ 测试登录功能
3. ✅ 使用决策分析和聊天功能
4. ✅ 测试退出登录

如果需要生产环境部署，请参考：
- `部署到生产环境.md`
- `VERCEL_DEPLOYMENT_GUIDE.md`

---

## 📞 获取帮助

如果遇到问题：
1. 查看本指南的"常见问题"部分
2. 运行 `python test-auth-api.py` 诊断后端
3. 检查浏览器控制台（F12）的错误信息
4. 查看后端窗口的日志输出

祝使用愉快！🎉


