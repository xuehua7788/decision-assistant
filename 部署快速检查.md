# 🔍 部署快速检查清单

> 在开始部署前，请按照此清单检查所有必要的配置

## ✅ 部署前检查

### 1. 代码准备

- [ ] 所有代码已提交到 Git
  ```bash
  git status
  git add .
  git commit -m "准备部署"
  ```

- [ ] 代码已推送到 GitHub
  ```bash
  git push origin main
  ```

- [ ] 本地测试通过
  ```bash
  # 后端测试
  cd backend
  uvicorn app.main:app --reload
  # 访问 http://localhost:8000/health
  
  # 前端测试
  cd frontend
  npm start
  # 访问 http://localhost:3000
  ```

### 2. 环境变量准备

- [ ] 已获取 DeepSeek API Key
  - 访问：https://platform.deepseek.com
  - 创建 API Key
  - 复制并保存密钥

- [ ] 确定前后端域名
  ```
  前端域名: https://__________.vercel.app
  后端域名: https://__________.onrender.com (或其他平台)
  ```

### 3. 配置文件检查

- [ ] `frontend/package.json` 存在且配置正确
  ```bash
  cd frontend
  cat package.json
  # 检查是否有 "react-scripts" 和正确的脚本命令
  ```

- [ ] `backend/requirements.txt` 存在且完整
  ```bash
  cd backend
  cat requirements.txt
  # 应该包含: fastapi, uvicorn, pydantic, requests 等
  ```

- [ ] `backend/app/main.py` 有健康检查端点
  ```python
  @app.get("/health")
  async def health_check():
      return {"status": "ok"}
  ```

---

## 🚀 部署步骤检查

### 方案选择

我选择的部署方案是：
- [ ] 方案1: Vercel + Render (免费)
- [ ] 方案2: Vercel + Railway (付费)
- [ ] 方案3: Cloudflare + Fly.io
- [ ] 方案4: 国内云服务
- [ ] 方案5: Docker + VPS

### 后端部署（先部署后端！）

#### 如果使用 Render:

- [ ] 已注册 Render 账号（https://render.com）
- [ ] 已连接 GitHub 仓库
- [ ] 已创建 Web Service
- [ ] 配置正确：
  ```
  Root Directory: backend
  Build Command: pip install -r requirements.txt
  Start Command: uvicorn app.main:app --host 0.0.0.0 --port $PORT
  ```
- [ ] 环境变量已设置：
  ```
  DEEPSEEK_API_KEY=sk-___________
  ```
- [ ] 部署成功，获得 URL
- [ ] 健康检查通过
  ```bash
  curl https://你的后端URL/health
  # 应返回: {"status":"ok"}
  ```

#### 如果使用 Railway:

- [ ] 已注册 Railway 账号（https://railway.app）
- [ ] 已绑定支付方式（获得 $5 试用）
- [ ] 已从 GitHub 导入项目
- [ ] Root Directory 设置为 `backend`
- [ ] 环境变量已设置：
  ```
  DEEPSEEK_API_KEY=sk-___________
  PORT=8000
  ```
- [ ] 已生成域名
- [ ] 健康检查通过

#### 如果使用 Fly.io:

- [ ] 已安装 Fly CLI
- [ ] 已登录 `fly auth login`
- [ ] 已在 backend 目录运行 `fly launch`
- [ ] 已设置密钥 `fly secrets set DEEPSEEK_API_KEY=sk-___`
- [ ] 已部署 `fly deploy`
- [ ] 健康检查通过

### 前端部署

#### 如果使用 Vercel:

- [ ] 已注册 Vercel 账号（https://vercel.com）
- [ ] 已安装 Vercel CLI（或使用 GitHub 集成）
- [ ] 已导入项目
- [ ] 配置正确：
  ```
  Framework: Create React App
  Root Directory: frontend
  Build Command: npm run build
  Output Directory: build
  ```
- [ ] 环境变量已设置：
  ```
  REACT_APP_API_URL=https://你的后端URL
  ```
- [ ] 已重新部署（如果是修改环境变量后）
- [ ] 前端可访问

#### 如果使用 Cloudflare Pages:

- [ ] 已注册 Cloudflare 账号
- [ ] 已连接 GitHub 仓库
- [ ] 构建配置正确：
  ```
  Build command: cd frontend && npm run build
  Build output directory: frontend/build
  ```
- [ ] 环境变量已设置
- [ ] 部署成功

### 连接前后端

- [ ] 后端 CORS 配置已更新
  ```python
  # backend/app/core/config.py
  allowed_origins: List[str] = [
      "http://localhost:3000",
      "https://你的前端域名.vercel.app",
  ]
  ```

- [ ] 推送代码，后端重新部署
- [ ] 前端环境变量包含正确的后端 URL
- [ ] 前端已重新部署

---

## 🧪 测试检查

### 后端测试

```bash
# 1. 健康检查
curl https://你的后端URL/health

# 预期返回:
{"status":"ok"}

# 2. 测试聊天端点（可选）
curl -X POST https://你的后端URL/chat \
  -H "Content-Type: application/json" \
  -d '{"session_id":"test-123","message":"Hello"}'

# 应该返回 AI 响应
```

### 前端测试

访问前端 URL: https://_________

- [ ] 页面正常加载，无白屏
- [ ] 打开浏览器开发者工具 (F12)
- [ ] Console 标签无红色错误
- [ ] Network 标签中 API 请求返回 200

### 功能测试

- [ ] **Decision Analysis 模式**
  - 点击 "Decision Analysis"
  - 输入决策问题
  - 点击 "Analyze Decision"
  - 等待 AI 响应
  - 检查是否返回分析结果

- [ ] **Chat Mode**
  - 点击 "Chat Mode"
  - 输入消息
  - 发送
  - 检查 AI 是否回复

- [ ] **Chat Viewer**
  - 点击 "Chat Viewer"
  - 检查是否显示聊天记录列表
  - 点击某个会话
  - 检查是否显示详细内容

---

## 🔧 常见问题诊断

### 问题 1: 前端显示"网络错误"或 CORS 错误

**检查：**
```bash
# 1. 检查后端是否运行
curl https://你的后端URL/health

# 2. 检查 Vercel 环境变量
vercel env ls

# 3. 查看浏览器控制台错误信息
```

**解决：**
- [ ] 确认后端 URL 正确（无多余斜杠）
- [ ] 确认后端 CORS 包含前端域名
- [ ] 确认环境变量已设置并重新部署

### 问题 2: 后端部署失败

**检查 Render/Railway 日志：**
```
查看 Dashboard 中的 Logs 标签
```

**常见原因：**
- [ ] `requirements.txt` 路径错误
- [ ] Root Directory 设置错误
- [ ] Python 版本不兼容
- [ ] 依赖安装失败

**解决：**
- [ ] 确认 Root Directory 是 `backend`
- [ ] 检查 `backend/requirements.txt` 存在
- [ ] 查看错误日志，安装缺失的依赖

### 问题 3: 后端响应很慢（Render 免费版）

**原因：** 15分钟无活动会休眠

**解决：**
- [ ] 等待 30-60 秒（首次访问）
- [ ] 使用 Uptime Robot 定时 ping
- [ ] 升级到付费版
- [ ] 切换到 Railway

### 问题 4: API 返回 500 错误

**检查：**
```bash
# 查看后端日志
# Render: Dashboard -> Logs
# Railway: 项目页面 -> Logs
```

**常见原因：**
- [ ] `DEEPSEEK_API_KEY` 未设置
- [ ] API Key 无效或额度用完
- [ ] 后端代码错误

**解决：**
- [ ] 检查环境变量是否正确设置
- [ ] 在 DeepSeek 控制台检查 API Key 状态
- [ ] 查看错误日志定位问题

---

## 📊 性能检查

### 加载速度

- [ ] 前端首次加载 < 3秒
- [ ] 后续页面切换 < 1秒
- [ ] API 响应时间 < 2秒

**测试工具：**
- [PageSpeed Insights](https://pagespeed.web.dev/)
- [GTmetrix](https://gtmetrix.com/)
- [WebPageTest](https://www.webpagetest.org/)

### 监控设置

- [ ] 设置 Uptime Robot 监控
  - 访问 https://uptimerobot.com
  - 添加监控：HTTP(s) 类型
  - URL: 后端健康检查端点
  - 间隔：5 分钟

- [ ] 设置错误追踪（可选）
  - Sentry: https://sentry.io
  - LogRocket: https://logrocket.com

---

## 🎉 部署完成确认

当以下所有项都打勾时，部署完成：

### 基础功能
- [ ] ✅ 前端可访问
- [ ] ✅ 后端健康检查通过
- [ ] ✅ 无 CORS 错误
- [ ] ✅ API 调用成功

### 核心功能
- [ ] ✅ Decision Analysis 工作正常
- [ ] ✅ Chat Mode 可以对话
- [ ] ✅ Chat Viewer 显示记录

### 性能和安全
- [ ] ✅ HTTPS 已启用
- [ ] ✅ 加载速度满意
- [ ] ✅ API Key 未暴露
- [ ] ✅ 监控已配置

---

## 📝 部署信息记录

完成部署后，记录以下信息：

```
部署日期: ___________
选择方案: ___________

前端:
  平台: ___________
  URL: https://___________
  环境变量: REACT_APP_API_URL=https://___________

后端:
  平台: ___________
  URL: https://___________
  区域: ___________
  环境变量: 
    - DEEPSEEK_API_KEY: sk-___________
    - ALLOWED_ORIGINS: ["https://___________"]

监控:
  Uptime Robot: ___________
  其他: ___________

备注:
___________
```

---

## 🔄 下次更新

当需要更新代码时：

```bash
# 1. 修改代码
# ... 编辑文件 ...

# 2. 本地测试
cd backend && uvicorn app.main:app --reload
cd frontend && npm start

# 3. 提交并推送
git add .
git commit -m "更新说明"
git push origin main

# 4. 自动部署
# Vercel/Render/Railway 会自动检测推送并部署

# 5. 验证部署
curl https://后端URL/health
# 访问前端 URL 测试功能
```

---

## 📚 参考资源

- [部署方案完整指南.md](部署方案完整指南.md) - 详细部署步骤
- [VERCEL_DEPLOYMENT_GUIDE.md](VERCEL_DEPLOYMENT_GUIDE.md) - Vercel 专项指南
- [快速启动指南.md](快速启动指南.md) - 本地开发
- [TECHNICAL_SUMMARY.md](TECHNICAL_SUMMARY.md) - 技术总结

---

**祝部署顺利！** 🚀

如遇问题，请参考 [部署方案完整指南.md](部署方案完整指南.md) 中的常见问题部分。

