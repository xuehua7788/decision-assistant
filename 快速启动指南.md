# 快速启动指南 ⚡

## 🚀 5分钟快速上手

### 前提条件

确保已安装：
- ✅ Python 3.8+
- ✅ Node.js 14+
- ✅ npm 或 yarn

---

## 方式一：使用启动脚本（推荐）

### Windows 用户

1. **双击运行现有的批处理文件：**
   ```
   启动.bat
   ```

2. **或创建新的启动脚本：**

创建 `start-dev.bat`：
```batch
@echo off
chcp 65001
echo ========================================
echo Decision Assistant - 开发环境启动
echo ========================================
echo.

echo [1/4] 检查 Python 和 Node.js...
python --version
node --version
echo.

echo [2/4] 启动后端服务...
start cmd /k "cd backend && pip install -r requirements.txt && uvicorn app.main:app --reload"
echo 后端服务启动中... (http://localhost:8000)
timeout /t 5 /nobreak >nul
echo.

echo [3/4] 启动前端服务...
start cmd /k "cd frontend && npm install && npm start"
echo 前端服务启动中... (http://localhost:3000)
echo.

echo [4/4] 完成！
echo.
echo ========================================
echo 服务已启动:
echo   - 后端 API: http://localhost:8000
echo   - 前端界面: http://localhost:3000
echo   - API 文档: http://localhost:8000/docs
echo ========================================
echo.
echo 按任意键退出此窗口（不会关闭服务）...
pause >nul
```

### Mac/Linux 用户

创建 `start-dev.sh`：
```bash
#!/bin/bash

echo "========================================"
echo "Decision Assistant - 开发环境启动"
echo "========================================"
echo ""

echo "[1/4] 检查 Python 和 Node.js..."
python3 --version
node --version
echo ""

echo "[2/4] 启动后端服务..."
cd backend
pip3 install -r requirements.txt
uvicorn app.main:app --reload &
BACKEND_PID=$!
cd ..
echo "后端服务启动 (PID: $BACKEND_PID)"
sleep 3
echo ""

echo "[3/4] 启动前端服务..."
cd frontend
npm install
npm start &
FRONTEND_PID=$!
cd ..
echo "前端服务启动 (PID: $FRONTEND_PID)"
echo ""

echo "[4/4] 完成！"
echo ""
echo "========================================"
echo "服务已启动:"
echo "  - 后端 API: http://localhost:8000"
echo "  - 前端界面: http://localhost:3000"
echo "  - API 文档: http://localhost:8000/docs"
echo "========================================"
echo ""
echo "要停止服务，运行: ./stop-dev.sh"
echo "或手动停止进程:"
echo "  Backend PID: $BACKEND_PID"
echo "  Frontend PID: $FRONTEND_PID"

# 保存 PID 以便后续停止
echo $BACKEND_PID > .backend.pid
echo $FRONTEND_PID > .frontend.pid
```

添加执行权限：
```bash
chmod +x start-dev.sh
./start-dev.sh
```

---

## 方式二：手动启动（逐步）

### 步骤 1：启动后端

打开终端 1：
```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload
```

看到以下输出表示成功：
```
INFO:     Uvicorn running on http://127.0.0.1:8000
✓ AI-powered decision routes loaded successfully
✓ Chat storage initialized at: chat_data
```

### 步骤 2：启动前端

打开终端 2：
```bash
cd frontend
npm install
npm start
```

浏览器会自动打开 `http://localhost:3000`

### 步骤 3：集成 ChatViewer（如需要）

按照 `INTEGRATION_GUIDE.md` 修改 `frontend/src/App.js`

---

## 方式三：使用 Docker（一键启动）

```bash
# 启动所有服务
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down
```

服务地址：
- 前端：http://localhost:3000
- 后端：http://localhost:8000

---

## ✅ 验证服务是否正常

### 1. 测试后端 API

打开浏览器或使用 curl：
```bash
# 健康检查
curl http://localhost:8000/health

# 应返回：
{"status":"healthy","service":"backend","ai":"DeepSeek"}
```

### 2. 测试前端

访问：http://localhost:3000

应该看到 Decision Assistant 的界面

### 3. 测试 ChatViewer API

```bash
# 获取所有会话
curl http://localhost:8000/api/decisions/sessions

# 应返回 JSON 数组
[
  {
    "session_id": "...",
    "created_at": "...",
    "message_count": 3,
    ...
  }
]
```

---

## 🔧 环境变量配置

### 开发环境

创建 `frontend/.env.development`：
```env
REACT_APP_API_URL=http://localhost:8000
```

### 生产环境

创建 `frontend/.env.production`：
```env
REACT_APP_API_URL=https://your-backend-url.onrender.com
```

### 后端环境变量（可选）

创建 `backend/.env`：
```env
# DeepSeek API Key（如果需要）
DEEPSEEK_API_KEY=your_api_key_here

# 聊天数据存储目录
CHAT_DATA_DIR=chat_data

# 数据库配置（如果使用）
DATABASE_URL=sqlite:///./decision.db
```

---

## 🐛 故障排除

### 问题 1：端口被占用

**错误：** `Address already in use`

**解决：**

Windows:
```cmd
# 查找占用端口的进程
netstat -ano | findstr :8000
netstat -ano | findstr :3000

# 终止进程（替换 PID）
taskkill /PID <PID> /F
```

Mac/Linux:
```bash
# 查找并终止进程
lsof -ti:8000 | xargs kill -9
lsof -ti:3000 | xargs kill -9
```

### 问题 2：Python 模块未找到

**错误：** `ModuleNotFoundError: No module named 'fastapi'`

**解决：**
```bash
cd backend
pip install -r requirements.txt

# 或使用虚拟环境
python -m venv venv
source venv/bin/activate  # Mac/Linux
venv\Scripts\activate     # Windows
pip install -r requirements.txt
```

### 问题 3：npm 依赖安装失败

**错误：** `npm ERR! ...`

**解决：**
```bash
cd frontend
rm -rf node_modules package-lock.json  # 删除缓存
npm cache clean --force
npm install
```

### 问题 4：CORS 错误

**错误：** `Access to fetch at 'http://localhost:8000' has been blocked by CORS`

**解决：**

检查 `backend/app/main.py` 中的 CORS 配置：
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # 开发环境可以用 "*"
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 问题 5：中文显示乱码

**PowerShell 乱码：**
```powershell
chcp 65001
$OutputEncoding = [System.Text.Encoding]::UTF8
```

**JSON 文件乱码：**
确保文件保存为 UTF-8 编码（无 BOM）

---

## 📋 开发工作流

### 日常开发流程

```bash
# 1. 启动服务
./start-dev.sh  # 或 start-dev.bat

# 2. 编辑代码
# - 后端：backend/ 目录（自动重载）
# - 前端：frontend/src/ 目录（自动刷新）

# 3. 测试功能
# 浏览器访问 http://localhost:3000

# 4. 查看日志
# 后端：终端 1
# 前端：终端 2

# 5. 提交代码
git add .
git commit -m "描述改动"
git push
```

### 查看聊天记录

#### 方式 1：PowerShell 脚本
```powershell
.\ViewChatUTF8.ps1
```

#### 方式 2：Web 界面
1. 启动服务
2. 访问 http://localhost:3000
3. 点击 "Chat Viewer" 标签

#### 方式 3：直接读取 JSON
```bash
# 使用 jq 格式化查看（需要安装 jq）
cat chat_data/YOUR-SESSION-ID.json | jq .

# 或简单查看
cat chat_data/*.json
```

---

## 🎯 快速命令速查表

### 后端相关

```bash
# 启动后端
cd backend && uvicorn app.main:app --reload

# 安装依赖
pip install -r requirements.txt

# 查看 API 文档
# 浏览器访问：http://localhost:8000/docs

# 测试 API
curl http://localhost:8000/health
curl http://localhost:8000/api/decisions/sessions
```

### 前端相关

```bash
# 启动前端
cd frontend && npm start

# 安装依赖
npm install

# 构建生产版本
npm run build

# 查看构建结果
ls -lh build/
```

### Docker 相关

```bash
# 启动所有服务
docker-compose up -d

# 查看运行状态
docker-compose ps

# 查看日志
docker-compose logs -f backend
docker-compose logs -f frontend

# 停止服务
docker-compose down

# 重新构建
docker-compose up -d --build
```

---

## 📦 部署到生产环境

### Vercel 部署（前端）

```bash
cd frontend

# 安装 Vercel CLI
npm install -g vercel

# 登录
vercel login

# 部署
vercel --prod

# 配置环境变量（在 Vercel 网站上）
REACT_APP_API_URL=https://your-backend.onrender.com
```

### Render 部署（后端）

1. 访问 https://render.com
2. 连接 GitHub 仓库
3. 创建 Web Service
4. 配置：
   ```
   Build: cd backend && pip install -r requirements.txt
   Start: cd backend && uvicorn app.main:app --host 0.0.0.0 --port $PORT
   ```
5. 部署

---

## 🎉 成功标志

当你看到以下内容，说明一切正常：

✅ **后端成功：**
```
INFO:     Uvicorn running on http://127.0.0.1:8000
✓ AI-powered decision routes loaded successfully
✓ Chat storage initialized at: chat_data
✓ AI service ready: DeepSeek API
```

✅ **前端成功：**
```
Compiled successfully!

You can now view decision-assistant in the browser.

  Local:            http://localhost:3000
  On Your Network:  http://192.168.x.x:3000
```

✅ **功能测试通过：**
- 能访问前端界面
- 能发送聊天消息
- 能查看聊天历史（ChatViewer）
- 能进行决策分析

---

## 📞 获取帮助

### 文档参考

- `技术总结-第三方开发者.md` - 完整技术方案
- `TECHNICAL_SUMMARY.md` - 英文详细文档
- `INTEGRATION_GUIDE.md` - ChatViewer 集成指南

### 日志文件位置

- 后端日志：终端输出
- 前端日志：浏览器控制台（F12）
- 聊天数据：`chat_data/*.json`

### 常用调试技巧

1. **检查服务是否运行：**
   ```bash
   curl http://localhost:8000/health
   curl http://localhost:3000
   ```

2. **查看详细错误：**
   - 后端：查看终端输出
   - 前端：打开浏览器 DevTools (F12) → Console

3. **清除缓存重试：**
   ```bash
   # 前端
   cd frontend && rm -rf node_modules package-lock.json && npm install
   
   # 后端（使用虚拟环境）
   cd backend && rm -rf venv && python -m venv venv && source venv/bin/activate && pip install -r requirements.txt
   ```

---

**最后更新：** 2025-10-13  
**版本：** 1.0  
**适用人员：** 所有开发者

