# 🚀 Decision Assistant - 完整项目源代码

> **一个基于 React + FastAPI + DeepSeek AI 的智能决策辅助系统**
> 
> 适用场景：提供给 GPT 分析、代码审查、协作开发、问题诊断

---

## 📦 项目概述

- **项目名称：** Decision Assistant（智能决策助手）
- **技术栈：** React 17 + FastAPI + Python 3.10+ + DeepSeek AI
- **主要功能：** AI 聊天咨询、决策分析、聊天记录管理
- **部署方案：** Vercel (前端) + Railway/Render (后端)

---

## 📂 项目结构

```
decision-assistant/
├── frontend/                    # React 前端应用
│   ├── public/
│   │   └── index.html
│   ├── src/
│   │   ├── App.js              # 主应用组件
│   │   ├── App.css             # 样式文件
│   │   ├── ChatViewer.js       # 聊天记录查看器
│   │   ├── index.js            # 入口文件
│   │   └── index.css           # 全局样式
│   ├── package.json            # 前端依赖
│   └── vercel.json             # Vercel 配置
│
├── backend/                     # FastAPI 后端
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py             # FastAPI 应用入口
│   │   ├── core/
│   │   │   └── config.py       # 配置管理
│   │   ├── routes/
│   │   │   ├── __init__.py
│   │   │   └── decision_routes.py  # API 路由
│   │   ├── services/
│   │   │   ├── __init__.py
│   │   │   ├── ai_service.py       # AI 服务
│   │   │   └── chat_storage.py     # 聊天存储
│   │   ├── algorithms/
│   │   │   └── decision_algorithms.py  # 决策算法
│   │   └── models/
│   │       └── database_models.py      # 数据模型
│   ├── chat_data/              # 聊天数据存储目录
│   ├── requirements.txt        # Python 依赖
│   └── Dockerfile              # Docker 配置
│
├── vercel.json                 # 根目录 Vercel 配置
├── docker-compose.yml          # Docker Compose 配置
└── README.md                   # 项目说明文档
```

---

## 📝 完整源代码

---

## 1️⃣ 前端代码 (Frontend)

### 📄 `frontend/package.json`

```json
{
  "name": "decision-assistant",
  "version": "1.0.0",
  "private": true,
  "dependencies": {
    "react": "^17.0.2",
    "react-dom": "^17.0.2",
    "react-scripts": "5.0.1",
    "web-vitals": "^5.1.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": [
    ">0.2%",
    "not dead",
    "not ie 11"
  ]
}
```

---

### 📄 `frontend/src/App.js`

```javascript
import React, { useState } from 'react';
import './App.css';
import ChatViewer from './ChatViewer';

function App() {
  const API_URL = process.env.REACT_APP_API_URL || window.location.origin;
  const [currentMode, setCurrentMode] = useState('analysis');
  const [description, setDescription] = useState('');
  const [options, setOptions] = useState(['', '']);
  const [chatMessages, setChatMessages] = useState([
    { type: 'assistant', text: "Hello! I'm your decision assistant. Tell me what decision you're facing, and I'll help you think through it step by step. What's on your mind?" }
  ]);
  const [chatInput, setChatInput] = useState('');
  const [result, setResult] = useState(null);
  const [loading, setLoading] = useState(false);

  const switchMode = (mode) => {
    setCurrentMode(mode);
    setResult(null);
  };

  const addOption = () => {
    setOptions([...options, '']);
  };

  const removeOption = (index) => {
    if (options.length > 1) {
      setOptions(options.filter((_, i) => i !== index));
    }
  };

  const updateOption = (index, value) => {
    const newOptions = [...options];
    newOptions[index] = value;
    setOptions(newOptions);
  };

  const analyzeDecision = async () => {
    const validOptions = options.filter(o => o.trim() !== '');
    
    if (!description || validOptions.length === 0) {
      alert('Please provide a description and at least one option');
      return;
    }

    setLoading(true);
    setResult(null);

    try {
      const response = await fetch(`${API_URL}/api/decisions/analyze`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          description: description,
          options: validOptions
        })
      });
      
      const data = await response.json();
      setResult(data);
      setLoading(false);
    } catch (error) {
      setResult({
        recommendation: 'Error',
        readable_summary: 'Could not connect to server: ' + error.message
      });
      setLoading(false);
    }
  };

  const sendMessage = async () => {
    if (!chatInput.trim()) return;

    setChatMessages([...chatMessages, { type: 'user', text: chatInput }]);
    const userMessage = chatInput;
    setChatInput('');

    try {
      const response = await fetch(`${API_URL}/api/decisions/chat`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: userMessage })
      });
      
      const data = await response.json();
      setChatMessages(prev => [...prev, { type: 'assistant', text: data.response }]);
    } catch (error) {
      setChatMessages(prev => [...prev, { type: 'assistant', text: 'Error: Could not connect to server' }]);
    }
  };

  return (
    <div style={{ 
      fontFamily: "'Segoe UI', system-ui, -apple-system, sans-serif",
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      minHeight: '100vh',
      padding: '20px'
    }}>
      <div style={{ maxWidth: '1000px', margin: '0 auto' }}>
        {/* Header */}
        <div style={{ textAlign: 'center', color: 'white', marginBottom: '20px' }}>
          <h1 style={{ fontSize: '2.5em', marginBottom: '10px', textShadow: '2px 2px 4px rgba(0,0,0,0.2)' }}>
            🤖 Decision Assistant
          </h1>
          <p>Powered by DeepSeek AI & Decision Algorithms</p>
        </div>

        {/* Mode Selector */}
        <div style={{ display: 'flex', justifyContent: 'center', gap: '20px', marginBottom: '30px' }}>
          <button
            onClick={() => switchMode('analysis')}
            style={{
              background: currentMode === 'analysis' ? '#ffd700' : 'white',
              color: currentMode === 'analysis' ? '#333' : '#667eea',
              padding: '10px 30px',
              border: 'none',
              borderRadius: '25px',
              cursor: 'pointer',
              fontSize: '1.1em',
              fontWeight: '600',
              transform: currentMode === 'analysis' ? 'scale(1.05)' : 'scale(1)'
            }}
          >
            📊 Decision Analysis
          </button>
          <button
            onClick={() => switchMode('chat')}
            style={{
              background: currentMode === 'chat' ? '#ffd700' : 'white',
              color: currentMode === 'chat' ? '#333' : '#667eea',
              padding: '10px 30px',
              border: 'none',
              borderRadius: '25px',
              cursor: 'pointer',
              fontSize: '1.1em',
              fontWeight: '600',
              transform: currentMode === 'chat' ? 'scale(1.05)' : 'scale(1)'
            }}
          >
            💬 Chat Mode
          </button>
        </div>

        {/* Analysis Mode */}
        {currentMode === 'analysis' && (
          <div style={{
            background: 'white',
            borderRadius: '15px',
            padding: '30px',
            boxShadow: '0 20px 40px rgba(0,0,0,0.1)',
            marginBottom: '20px'
          }}>
            <div style={{ marginBottom: '25px' }}>
              <label style={{ display: 'block', marginBottom: '8px', color: '#333', fontWeight: '600', fontSize: '1.1em' }}>
                📝 Describe your decision:
              </label>
              <textarea
                value={description}
                onChange={(e) => setDescription(e.target.value)}
                rows="3"
                placeholder="e.g., I'm considering buying a new laptop for work..."
                style={{
                  width: '100%',
                  padding: '12px',
                  border: '2px solid #e0e0e0',
                  borderRadius: '8px',
                  fontSize: '1em'
                }}
              />
            </div>

            <div style={{ marginBottom: '25px' }}>
              <label style={{ display: 'block', marginBottom: '8px', color: '#333', fontWeight: '600', fontSize: '1.1em' }}>
                🔢 Options to consider:
              </label>
              {options.map((option, index) => (
                <div key={index} style={{ display: 'flex', gap: '10px', marginBottom: '10px' }}>
                  <input
                    type="text"
                    value={option}
                    onChange={(e) => updateOption(index, e.target.value)}
                    placeholder={`Option ${index + 1}`}
                    style={{
                      flex: 1,
                      padding: '12px',
                      border: '2px solid #e0e0e0',
                      borderRadius: '8px',
                      fontSize: '1em'
                    }}
                  />
                  <button
                    onClick={() => removeOption(index)}
                    style={{
                      background: '#f56565',
                      color: 'white',
                      padding: '8px 16px',
                      border: 'none',
                      borderRadius: '8px',
                      cursor: 'pointer'
                    }}
                  >
                    Remove
                  </button>
                </div>
              ))}
              <button
                onClick={addOption}
                style={{
                  background: '#48bb78',
                  color: 'white',
                  padding: '8px 16px',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  marginTop: '10px'
                }}
              >
                + Add Option
              </button>
            </div>

            <button
              onClick={analyzeDecision}
              disabled={loading}
              style={{
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                width: '100%',
                padding: '15px',
                border: 'none',
                borderRadius: '8px',
                fontSize: '1.1em',
                cursor: loading ? 'not-allowed' : 'pointer',
                fontWeight: '600'
              }}
            >
              {loading ? '⏳ Analyzing...' : '🔍 Analyze My Decision'}
            </button>
          </div>
        )}

        {/* Chat Mode */}
        {currentMode === 'chat' && (
          <div style={{
            background: 'white',
            borderRadius: '15px',
            padding: '30px',
            boxShadow: '0 20px 40px rgba(0,0,0,0.1)',
            marginBottom: '20px'
          }}>
            <div style={{
              minHeight: '400px',
              maxHeight: '400px',
              overflowY: 'auto',
              border: '2px solid #e0e0e0',
              borderRadius: '10px',
              padding: '20px',
              marginBottom: '20px',
              background: '#fafafa'
            }}>
              {chatMessages.map((msg, idx) => (
                <div
                  key={idx}
                  style={{
                    marginBottom: '15px',
                    padding: '12px 16px',
                    borderRadius: '10px',
                    maxWidth: '80%',
                    marginLeft: msg.type === 'user' ? 'auto' : '0',
                    background: msg.type === 'user' 
                      ? 'linear-gradient(135deg, #667eea, #764ba2)'
                      : 'white',
                    color: msg.type === 'user' ? 'white' : '#333',
                    border: msg.type === 'assistant' ? '1px solid #e0e0e0' : 'none',
                    textAlign: msg.type === 'user' ? 'right' : 'left'
                  }}
                >
                  {msg.text}
                </div>
              ))}
            </div>

            <div style={{ display: 'flex', gap: '10px' }}>
              <input
                type="text"
                value={chatInput}
                onChange={(e) => setChatInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                placeholder="Type your message..."
                style={{
                  flex: 1,
                  padding: '12px',
                  border: '2px solid #e0e0e0',
                  borderRadius: '8px',
                  fontSize: '1em'
                }}
              />
              <button
                onClick={sendMessage}
                style={{
                  padding: '12px 24px',
                  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontWeight: '600'
                }}
              >
                Send
              </button>
            </div>
          </div>
        )}

        {/* Results */}
        {result && (
          <div style={{
            background: 'white',
            borderRadius: '15px',
            padding: '30px',
            boxShadow: '0 20px 40px rgba(0,0,0,0.1)'
          }}>
            <h2>📊 Decision Analysis Results</h2>
            
            <div style={{
              background: 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)',
              color: 'white',
              padding: '20px',
              borderRadius: '10px',
              marginTop: '20px',
              marginBottom: '20px'
            }}>
              <h3>✅ Recommendation</h3>
              <p style={{ fontSize: '1.3em', fontWeight: 'bold' }}>{result.recommendation}</p>
            </div>

            <div style={{
              background: '#f8f9fa',
              borderRadius: '10px',
              padding: '20px',
              marginBottom: '20px'
            }}>
              <h3>📄 Summary</h3>
              <div style={{ whiteSpace: 'pre-wrap', lineHeight: '1.6' }}>
                {result.readable_summary}
              </div>
            </div>

            {result.algorithm_analysis?.algorithms_used?.weighted_score?.results && (
              <div style={{
                background: '#f8f9fa',
                borderRadius: '10px',
                padding: '20px'
              }}>
                <h3>📈 Score Analysis</h3>
                {Object.entries(result.algorithm_analysis.algorithms_used.weighted_score.results).map(([option, scores]) => (
                  <div key={option} style={{
                    background: 'white',
                    padding: '10px 15px',
                    borderRadius: '8px',
                    marginBottom: '10px',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                  }}>
                    <span><strong>{option}</strong></span>
                    <span>{scores.total_score}/10</span>
                  </div>
                ))}
              </div>
            )}

            <button
              onClick={() => window.location.reload()}
              style={{
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                width: '100%',
                padding: '15px',
                border: 'none',
                borderRadius: '8px',
                fontSize: '1.1em',
                cursor: 'pointer',
                fontWeight: '600',
                marginTop: '20px'
              }}
            >
              🔄 New Analysis
            </button>
          </div>
        )}
      </div>
    </div>
  );
}

export default App;
```

---

### 📄 `frontend/src/ChatViewer.js`

```javascript
import React, { useState, useEffect } from 'react';

function ChatViewer() {
  const [sessions, setSessions] = useState([]);
  const [selectedSession, setSelectedSession] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const API_URL = process.env.REACT_APP_API_URL || window.location.origin;

  useEffect(() => {
    fetchSessions();
  }, []);

  const fetchSessions = async () => {
    try {
      setLoading(true);
      setError(null);
      const response = await fetch(`${API_URL}/api/decisions/sessions`);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      setSessions(data);
      setLoading(false);
    } catch (error) {
      console.error('Failed to fetch sessions:', error);
      setError('无法连接到服务器，请确认后端服务正在运行');
      setLoading(false);
    }
  };

  const viewSession = async (sessionId) => {
    try {
      const response = await fetch(`${API_URL}/api/decisions/session/${sessionId}`);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      setSelectedSession(data);
    } catch (error) {
      console.error('Failed to fetch session:', error);
      alert('加载会话失败：' + error.message);
    }
  };

  const formatDateTime = (isoString) => {
    if (!isoString) return 'N/A';
    const date = new Date(isoString);
    return date.toLocaleString('zh-CN', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
  };

  return (
    <div style={{ 
      fontFamily: "'Segoe UI', system-ui, -apple-system, sans-serif",
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      minHeight: '100vh',
      padding: '20px'
    }}>
      <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
        <div style={{ textAlign: 'center', color: 'white', marginBottom: '20px' }}>
          <h1 style={{ fontSize: '2.5em', marginBottom: '10px', textShadow: '2px 2px 4px rgba(0,0,0,0.2)' }}>
            💬 聊天记录查看器
          </h1>
          <p>功能等价于 ViewChatUTF8.ps1 的 Web 版本</p>
          {error && (
            <div style={{
              background: '#f56565',
              color: 'white',
              padding: '10px',
              borderRadius: '8px',
              marginTop: '10px'
            }}>
              ⚠️ {error}
            </div>
          )}
        </div>

        <div style={{
          background: 'white',
          borderRadius: '15px',
          padding: '30px',
          boxShadow: '0 20px 40px rgba(0,0,0,0.1)',
          minHeight: '600px'
        }}>
          <div style={{ display: 'flex', gap: '30px', height: '100%' }}>
            
            {/* Left Side: Session List */}
            <div style={{ 
              flex: '0 0 350px', 
              borderRight: '2px solid #e0e0e0', 
              paddingRight: '20px',
              maxHeight: '700px',
              overflowY: 'auto'
            }}>
              <div style={{ 
                display: 'flex', 
                justifyContent: 'space-between', 
                alignItems: 'center',
                marginBottom: '15px'
              }}>
                <h2 style={{ margin: 0, color: '#333' }}>📋 会话列表</h2>
                <button
                  onClick={fetchSessions}
                  style={{
                    background: '#667eea',
                    color: 'white',
                    border: 'none',
                    padding: '8px 16px',
                    borderRadius: '5px',
                    cursor: 'pointer',
                    fontSize: '14px'
                  }}
                >
                  🔄 刷新
                </button>
              </div>

              {loading ? (
                <div style={{ textAlign: 'center', padding: '40px 0', color: '#999' }}>
                  <div style={{ fontSize: '40px', marginBottom: '10px' }}>⏳</div>
                  <p>加载中...</p>
                </div>
              ) : sessions.length === 0 ? (
                <div style={{ textAlign: 'center', padding: '40px 0', color: '#999' }}>
                  <div style={{ fontSize: '40px', marginBottom: '10px' }}>📭</div>
                  <p>暂无聊天记录</p>
                </div>
              ) : (
                <div>
                  {sessions.map((session, index) => (
                    <div 
                      key={session.session_id}
                      onClick={() => viewSession(session.session_id)}
                      style={{
                        padding: '15px',
                        margin: '10px 0',
                        border: '2px solid #e0e0e0',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        backgroundColor: selectedSession?.session_id === session.session_id 
                          ? '#e3f2fd' 
                          : 'white',
                        transition: 'all 0.2s',
                        boxShadow: selectedSession?.session_id === session.session_id 
                          ? '0 4px 8px rgba(102, 126, 234, 0.2)' 
                          : 'none'
                      }}
                      onMouseEnter={(e) => {
                        if (selectedSession?.session_id !== session.session_id) {
                          e.currentTarget.style.backgroundColor = '#f5f5f5';
                        }
                      }}
                      onMouseLeave={(e) => {
                        if (selectedSession?.session_id !== session.session_id) {
                          e.currentTarget.style.backgroundColor = 'white';
                        }
                      }}
                    >
                      <div style={{ 
                        fontWeight: 'bold', 
                        marginBottom: '8px',
                        color: '#667eea',
                        fontSize: '16px'
                      }}>
                        #{index + 1}
                      </div>
                      <div style={{ fontSize: '13px', color: '#666', marginBottom: '5px' }}>
                        🕐 {formatDateTime(session.created_at)}
                      </div>
                      <div style={{ fontSize: '13px', color: '#888', marginBottom: '8px' }}>
                        💬 消息数: <strong>{session.message_count}</strong>
                      </div>
                      <div style={{ 
                        fontSize: '12px', 
                        color: '#999', 
                        lineHeight: '1.4',
                        overflow: 'hidden',
                        textOverflow: 'ellipsis',
                        display: '-webkit-box',
                        WebkitLineClamp: 2,
                        WebkitBoxOrient: 'vertical'
                      }}>
                        {session.first_message || '(空会话)'}
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Right Side: Session Details */}
            <div style={{ flex: 1, maxHeight: '700px', overflowY: 'auto' }}>
              <h2 style={{ marginTop: 0, color: '#333' }}>📝 消息详情</h2>
              
              {selectedSession ? (
                <div>
                  {/* Session Info Card */}
                  <div style={{ 
                    marginBottom: '25px', 
                    padding: '20px', 
                    background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)',
                    borderRadius: '10px',
                    border: '1px solid #e0e0e0'
                  }}>
                    <div style={{ marginBottom: '10px' }}>
                      <strong>🆔 Session ID:</strong>
                      <code style={{ 
                        marginLeft: '10px', 
                        background: 'white', 
                        padding: '4px 8px', 
                        borderRadius: '4px',
                        fontSize: '12px'
                      }}>
                        {selectedSession.session_id}
                      </code>
                    </div>
                    <div style={{ marginBottom: '10px' }}>
                      <strong>📅 创建时间:</strong> {formatDateTime(selectedSession.created_at)}
                    </div>
                    <div style={{ marginBottom: '10px' }}>
                      <strong>🕐 最后活动:</strong> {formatDateTime(selectedSession.last_activity)}
                    </div>
                    <div>
                      <strong>💬 消息总数:</strong> {selectedSession.messages.length}
                    </div>
                  </div>
                  
                  {/* Messages List */}
                  {selectedSession.messages.map((msg, index) => (
                    <div 
                      key={index}
                      style={{
                        padding: '18px',
                        margin: '15px 0',
                        borderRadius: '10px',
                        backgroundColor: msg.role === 'user' ? '#e3f2fd' : '#f5f5f5',
                        borderLeft: `5px solid ${msg.role === 'user' ? '#2196f3' : '#4caf50'}`,
                        boxShadow: '0 2px 4px rgba(0,0,0,0.05)',
                        transition: 'transform 0.2s',
                      }}
                      onMouseEnter={(e) => e.currentTarget.style.transform = 'translateX(5px)'}
                      onMouseLeave={(e) => e.currentTarget.style.transform = 'translateX(0)'}
                    >
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '10px'
                      }}>
                        <div style={{ 
                          fontWeight: 'bold', 
                          color: msg.role === 'user' ? '#1976d2' : '#388e3c',
                          fontSize: '14px'
                        }}>
                          {msg.role === 'user' ? '👤 用户' : '🤖 助手'}
                        </div>
                        <div style={{ fontSize: '11px', color: '#999' }}>
                          {formatDateTime(msg.timestamp)}
                        </div>
                      </div>
                      <div style={{ 
                        whiteSpace: 'pre-wrap', 
                        lineHeight: '1.6',
                        color: '#333',
                        fontSize: '14px'
                      }}>
                        {msg.content}
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div style={{ 
                  textAlign: 'center', 
                  color: '#999', 
                  marginTop: '100px',
                  padding: '40px'
                }}>
                  <div style={{ fontSize: '80px', marginBottom: '20px', opacity: 0.3 }}>📭</div>
                  <p style={{ fontSize: '18px' }}>请从左侧选择一个会话查看详情</p>
                  <p style={{ fontSize: '14px', marginTop: '10px' }}>
                    功能等价于 <code>ViewChatUTF8.ps1</code>
                  </p>
                </div>
              )}
            </div>
          </div>
        </div>

        <div style={{ 
          textAlign: 'center', 
          color: 'white', 
          marginTop: '20px',
          fontSize: '14px',
          opacity: 0.8
        }}>
          <p>此页面等价于 ViewChatUTF8.ps1 PowerShell 脚本</p>
          <p>数据源: {API_URL}/api/decisions/sessions</p>
        </div>
      </div>
    </div>
  );
}

export default ChatViewer;
```

---

### 📄 `frontend/src/index.js`

```javascript
import React from 'react';
import ReactDOM from 'react-dom';
import './index.css';
import App from './App';

ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById('root')
);
```

---

### 📄 `frontend/src/index.css`

```css
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}

* {
  box-sizing: border-box;
}
```

---

### 📄 `frontend/src/App.css`

```css
.App {
  text-align: center;
}

.App-header {
  background-color: #282c34;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: calc(10px + 2vmin);
  color: white;
}
```

---

### 📄 `frontend/public/index.html`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Decision Assistant - AI-powered decision making tool"
    />
    <title>Decision Assistant</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
```

---

### 📄 `frontend/vercel.json`

```json
{
  "version": 2,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "build"
      }
    }
  ],
  "routes": [
    {
      "src": "/static/(.*)",
      "dest": "/static/$1"
    },
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
```

---

## 2️⃣ 后端代码 (Backend)

### 📄 `backend/requirements.txt`

```
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.4.2
pydantic-settings==2.0.3
python-multipart==0.0.6
numpy==1.24.3
requests==2.31.0
python-dotenv==1.0.0
```

---

### 📄 `backend/app/main.py`

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

from app.core.config import get_settings
from app.services.chat_storage import chat_storage
from app.services.ai_service import ai_service

settings = get_settings()

app = FastAPI(
    title=settings.api_title,
    version=settings.api_version,
    root_path=settings.api_root_path,
)

app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.allowed_origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

print(f"Chat storage initialized at: {chat_storage.storage_dir}")
print(f"Settings loaded. Max history messages: {settings.max_history_messages}")
print(
    "DeepSeek API key loaded."
    if settings.deepseek_api_key
    else "Warning: DeepSeek API key is not set."
)


@app.get("/health")
async def health_check():
    return {"status": "ok"}


@app.post("/chat")
async def chat_endpoint(request: dict):
    session_id = request.get("session_id")
    user_message = request.get("message")

    if not session_id or not user_message:
        return {"error": "session_id and message are required fields"}

    chat_storage.add_message(session_id, "user", user_message)

    history = chat_storage.get_session(session_id)
    messages = history["messages"][-settings.max_history_messages :] if history else []

    response = await ai_service.generate_response(session_id, messages, user_message)

    chat_storage.add_message(session_id, "assistant", response)

    return {"response": response}


@app.get("/sessions")
async def list_sessions():
    return chat_storage.get_all_sessions()


@app.get("/sessions/{session_id}")
async def get_session(session_id: str):
    session = chat_storage.get_session(session_id)
    if session is None:
        return {"error": "Session not found"}
    return session


@app.delete("/sessions/{session_id}")
async def delete_session(session_id: str):
    deleted = chat_storage.delete_session(session_id)
    if not deleted:
        return {"error": "Session not found"}
    return {"status": "deleted"}


@app.get("/", summary="Service root", tags=["Health"])
async def read_root() -> dict[str, str]:
    return {"message": "Decision Assistant API"}
```

---

### 📄 `backend/app/core/config.py`

```python
from functools import lru_cache
from typing import List, Optional

from pydantic_settings import BaseSettings, SettingsConfigDict


class Settings(BaseSettings):
    model_config = SettingsConfigDict(
        env_file=".env",
        env_file_encoding="utf-8",
        extra="ignore",
    )

    api_title: str = "Decision Assistant API"
    api_version: str = "1.0.0"
    api_root_path: str = ""

    deepseek_api_key: Optional[str] = None

    chat_storage_dir: str = "chat_data"
    max_history_messages: int = 20

    allowed_origins: List[str] = [
        "http://localhost:3000",
        "http://127.0.0.1:3000",
    ]


@lru_cache
def get_settings() -> Settings:
    return Settings()
```

---

### 📄 `backend/app/routes/decision_routes.py`

```python
from fastapi import APIRouter, HTTPException
from pydantic import BaseModel
from typing import Optional
import uuid
from app.services.chat_storage import chat_storage
from app.services.ai_service import ai_service

router = APIRouter()

class ChatMessage(BaseModel):
    message: str
    session_id: Optional[str] = None

class ChatResponse(BaseModel):
    response: str
    session_id: str
    total_messages: int

@router.post("/chat", response_model=ChatResponse)
async def chat_with_assistant(chat_message: ChatMessage):
    """处理聊天消息并返回 AI 响应"""
    try:
        # 获取或创建 session_id
        session_id = chat_message.session_id or str(uuid.uuid4())
        
        # 保存用户消息
        chat_storage.add_message(
            session_id=session_id,
            role="user",
            content=chat_message.message
        )
        
        # 获取历史消息作为上下文
        session_data = chat_storage.get_session(session_id)
        context = session_data.get("messages", []) if session_data else []
        
        # 获取 AI 回复（使用真正的 AI 服务）
        ai_response = ai_service.get_response(chat_message.message, context)
        
        # 保存 AI 回复
        chat_storage.add_message(
            session_id=session_id,
            role="assistant",
            content=ai_response
        )
        
        # 获取更新后的消息总数
        updated_session = chat_storage.get_session(session_id)
        total_messages = len(updated_session.get("messages", []))
        
        return ChatResponse(
            response=ai_response,
            session_id=session_id,
            total_messages=total_messages
        )
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/sessions")
async def get_all_sessions():
    """获取所有会话列表"""
    return chat_storage.get_all_sessions()

@router.get("/session/{session_id}")
async def get_session_history(session_id: str):
    """获取特定会话的历史记录"""
    session_data = chat_storage.get_session(session_id)
    if not session_data:
        raise HTTPException(status_code=404, detail="Session not found")
    return session_data
```

---

### 📄 `backend/app/services/ai_service.py`

```python
import os
from typing import Optional, List
import requests
import json
from dotenv import load_dotenv
from app.core.config import get_settings

load_dotenv()
settings = get_settings()


class AIService:
    def __init__(self):
        """初始化 AI 服务"""
        self.api_key = settings.deepseek_api_key
        self.api_url = "https://api.deepseek.com/v1/chat/completions"
        self.ai_available = bool(self.api_key)

    async def generate_response(
        self, session_id: str, messages: List[dict], user_message: str
    ) -> str:
        """生成 AI 回复"""
        if not self.ai_available:
            return self._get_mock_response(user_message)

        try:
            # 构建消息历史
            chat_messages = [
                {
                    "role": "system",
                    "content": "You are a helpful decision-making assistant. Help users think through their decisions by asking clarifying questions and providing balanced perspectives.",
                }
            ]

            # 添加历史消息（最近 10 条）
            for msg in messages[-10:]:
                chat_messages.append(
                    {"role": msg["role"], "content": msg["content"]}
                )

            # 调用 DeepSeek API
            headers = {
                "Authorization": f"Bearer {self.api_key}",
                "Content-Type": "application/json",
            }

            data = {
                "model": "deepseek-chat",
                "messages": chat_messages,
                "temperature": 0.7,
                "max_tokens": 1000,
            }

            response = requests.post(self.api_url, headers=headers, json=data)

            if response.status_code == 200:
                result = response.json()
                return result["choices"][0]["message"]["content"]
            else:
                print(f"DeepSeek API error: {response.status_code}")
                return self._get_mock_response(user_message)

        except Exception as e:
            print(f"AI API error: {e}")
            return self._get_mock_response(user_message)

    def get_response(self, message: str, context: Optional[List] = None) -> str:
        """获取 AI 回复（同步版本）"""
        if not self.ai_available:
            return self._get_mock_response(message)

        try:
            messages = self._build_messages(message, context)

            headers = {
                "Authorization": f"Bearer {self.api_key}",
                "Content-Type": "application/json",
            }

            data = {
                "model": "deepseek-chat",
                "messages": messages,
                "temperature": 0.7,
                "max_tokens": 1000,
            }

            response = requests.post(self.api_url, headers=headers, json=data)

            if response.status_code == 200:
                result = response.json()
                return result["choices"][0]["message"]["content"]
            else:
                print(f"DeepSeek API error: {response.status_code}")
                return self._get_mock_response(message)

        except Exception as e:
            print(f"AI API error: {e}")
            return self._get_mock_response(message)

    def _build_messages(
        self, message: str, context: Optional[List] = None
    ) -> List[dict]:
        """构建消息历史"""
        messages = [
            {
                "role": "system",
                "content": "You are a helpful decision-making assistant.",
            }
        ]

        # 添加历史上下文
        if context:
            for msg in context[-10:]:  # 最近 10 条
                messages.append(
                    {"role": msg.get("role"), "content": msg.get("content")}
                )

        # 添加当前消息
        messages.append({"role": "user", "content": message})

        return messages

    def _get_mock_response(self, message: str) -> str:
        """模拟响应（当 API 不可用时）"""
        responses = {
            "hello": "Hello! I'm your decision assistant. How can I help you today?",
            "help": "I can help you make decisions by analyzing options and providing insights.",
            "default": f"I received your message: '{message[:50]}...'. This is a mock response because the AI API is not configured.",
        }

        message_lower = message.lower()
        if "hello" in message_lower or "hi" in message_lower:
            return responses["hello"]
        elif "help" in message_lower:
            return responses["help"]
        else:
            return responses["default"]


# 创建全局实例
ai_service = AIService()
```

---

### 📄 `backend/app/services/chat_storage.py`

```python
import json
import os
from datetime import datetime
from typing import Dict, List, Optional
from pathlib import Path
from app.core.config import get_settings

settings = get_settings()


class ChatStorage:
    def __init__(self, storage_dir: str = None):
        """初始化聊天存储"""
        self.storage_dir = Path(storage_dir or settings.chat_storage_dir)
        self.storage_dir.mkdir(exist_ok=True)

    def add_message(self, session_id: str, role: str, content: str) -> None:
        """添加消息到会话"""
        file_path = self.storage_dir / f"{session_id}.json"

        if file_path.exists():
            with open(file_path, "r", encoding="utf-8") as f:
                data = json.load(f)
        else:
            data = {
                "session_id": session_id,
                "created_at": datetime.now().isoformat(),
                "messages": [],
            }

        data["messages"].append(
            {
                "role": role,
                "content": content,
                "timestamp": datetime.now().isoformat(),
            }
        )

        data["last_activity"] = datetime.now().isoformat()

        with open(file_path, "w", encoding="utf-8") as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

    def get_session(self, session_id: str) -> Optional[Dict]:
        """获取会话数据"""
        file_path = self.storage_dir / f"{session_id}.json"

        if file_path.exists():
            with open(file_path, "r", encoding="utf-8") as f:
                return json.load(f)
        return None

    def get_all_sessions(self) -> List[Dict]:
        """获取所有会话摘要"""
        sessions = []

        for file_path in self.storage_dir.glob("*.json"):
            try:
                with open(file_path, "r", encoding="utf-8") as f:
                    data = json.load(f)
                    summary = {
                        "session_id": data.get("session_id"),
                        "created_at": data.get("created_at"),
                        "last_activity": data.get("last_activity"),
                        "message_count": len(data.get("messages", [])),
                        "first_message": (
                            data.get("messages", [{}])[0].get("content", "")[:100]
                            if data.get("messages")
                            else ""
                        ),
                    }
                    sessions.append(summary)
            except Exception as e:
                print(f"Error reading {file_path}: {e}")

        sessions.sort(key=lambda x: x.get("last_activity", ""), reverse=True)
        return sessions

    def delete_session(self, session_id: str) -> bool:
        """删除会话"""
        file_path = self.storage_dir / f"{session_id}.json"

        if file_path.exists():
            file_path.unlink()
            return True
        return False


# 创建全局实例
chat_storage = ChatStorage()
```

---

### 📄 `backend/app/algorithms/decision_algorithms.py`

```python
"""
Decision Making Algorithms Module
包含多种决策分析算法
"""

import numpy as np
from typing import List, Dict, Any
from dataclasses import dataclass
import json

@dataclass
class DecisionCriteria:
    """决策标准"""
    name: str
    weight: float
    description: str

@dataclass
class Option:
    """决策选项"""
    name: str
    scores: Dict[str, float]
    
class WeightedScoreAnalysis:
    """加权评分决策算法"""
    
    def __init__(self):
        self.default_criteria = [
            DecisionCriteria("cost_effectiveness", 0.25, "成本效益"),
            DecisionCriteria("time_efficiency", 0.20, "时间效率"),
            DecisionCriteria("risk_level", 0.20, "风险水平"),
            DecisionCriteria("long_term_benefit", 0.20, "长期收益"),
            DecisionCriteria("feasibility", 0.15, "可行性")
        ]
    
    def analyze(self, options: List[str], context: str = "") -> Dict[str, Any]:
        """分析决策选项"""
        results = {}
        
        for option in options:
            # 基于选项文本生成模拟评分
            scores = self._generate_scores(option, context)
            weighted_score = self._calculate_weighted_score(scores)
            
            results[option] = {
                "total_score": round(weighted_score, 2),
                "scores": scores,
                "rank": 0  # 将在后面计算
            }
        
        # 计算排名
        sorted_options = sorted(results.items(), key=lambda x: x[1]["total_score"], reverse=True)
        for rank, (option, data) in enumerate(sorted_options, 1):
            results[option]["rank"] = rank
            
        return {
            "algorithm": "Weighted Score Analysis",
            "results": results,
            "recommendation": sorted_options[0][0] if sorted_options else None,
            "criteria_used": [c.name for c in self.default_criteria]
        }
    
    def _generate_scores(self, option: str, context: str) -> Dict[str, float]:
        """生成评分（实际应用中应基于更复杂的逻辑）"""
        base_score = 5.0
        
        scores = {}
        for criteria in self.default_criteria:
            score = base_score
            
            if criteria.name == "cost_effectiveness":
                if "cheap" in option.lower() or "budget" in option.lower():
                    score += 3
                elif "expensive" in option.lower() or "high-end" in option.lower():
                    score -= 2
                    
            elif criteria.name == "time_efficiency":
                if "now" in option.lower() or "immediate" in option.lower():
                    score += 2
                elif "wait" in option.lower() or "later" in option.lower():
                    score -= 1
                    
            elif criteria.name == "risk_level":
                if "safe" in option.lower() or "secure" in option.lower():
                    score += 2
                elif "risky" in option.lower():
                    score -= 3
                    
            scores[criteria.name] = min(10, max(1, score))
            
        return scores
    
    def _calculate_weighted_score(self, scores: Dict[str, float]) -> float:
        """计算加权总分"""
        total = 0
        for criteria in self.default_criteria:
            total += scores.get(criteria.name, 5) * criteria.weight
        return total

class ProsConsAnalysis:
    """优缺点分析算法"""
    
    def analyze(self, options: List[str], description: str) -> Dict[str, Any]:
        """分析每个选项的优缺点"""
        results = {}
        
        for option in options:
            pros, cons = self._extract_pros_cons(option, description)
            results[option] = {
                "pros": pros,
                "cons": cons,
                "pros_count": len(pros),
                "cons_count": len(cons),
                "balance": len(pros) - len(cons)
            }
        
        best_option = max(results.items(), key=lambda x: x[1]["balance"])
        
        return {
            "algorithm": "Pros and Cons Analysis",
            "results": results,
            "recommendation": best_option[0],
            "reasoning": f"Based on pros/cons balance: {best_option[1]['balance']}"
        }
    
    def _extract_pros_cons(self, option: str, context: str) -> tuple:
        """提取优缺点（简化版本）"""
        pros = []
        cons = []
        
        positive_keywords = ["good", "best", "now", "immediate", "save", "efficient"]
        negative_keywords = ["wait", "expensive", "risk", "delay", "costly"]
        
        option_lower = option.lower()
        
        for keyword in positive_keywords:
            if keyword in option_lower:
                pros.append(f"Indicates {keyword}")
                
        for keyword in negative_keywords:
            if keyword in option_lower:
                cons.append(f"Involves {keyword}")
        
        if not pros:
            pros = ["Viable option", "Worth considering"]
        if not cons:
            cons = ["Requires evaluation", "May have hidden costs"]
            
        return pros, cons

class DecisionMatrix:
    """决策矩阵算法"""
    
    def analyze(self, options: List[str], criteria: List[str] = None) -> Dict[str, Any]:
        """使用决策矩阵分析"""
        if not criteria:
            criteria = ["Cost", "Time", "Quality", "Risk", "Impact"]
        
        matrix = {}
        for option in options:
            matrix[option] = {}
            for criterion in criteria:
                score = np.random.randint(3, 10)
                matrix[option][criterion] = score
        
        totals = {}
        for option, scores in matrix.items():
            totals[option] = sum(scores.values())
        
        best_option = max(totals.items(), key=lambda x: x[1])
        
        return {
            "algorithm": "Decision Matrix",
            "matrix": matrix,
            "totals": totals,
            "recommendation": best_option[0],
            "criteria": criteria
        }

class DecisionAnalyzer:
    """综合决策分析器"""
    
    def __init__(self):
        self.weighted_score = WeightedScoreAnalysis()
        self.pros_cons = ProsConsAnalysis()
        self.decision_matrix = DecisionMatrix()
    
    def comprehensive_analysis(self, description: str, options: List[str]) -> Dict[str, Any]:
        """执行综合分析"""
        
        weighted_result = self.weighted_score.analyze(options, description)
        pros_cons_result = self.pros_cons.analyze(options, description)
        matrix_result = self.decision_matrix.analyze(options)
        
        recommendations = [
            weighted_result.get("recommendation"),
            pros_cons_result.get("recommendation"),
            matrix_result.get("recommendation")
        ]
        
        from collections import Counter
        vote_counts = Counter(recommendations)
        final_recommendation = vote_counts.most_common(1)[0][0] if recommendations else options[0]
        
        return {
            "description": description,
            "options": options,
            "algorithms_used": {
                "weighted_score": weighted_result,
                "pros_cons": pros_cons_result,
                "decision_matrix": matrix_result
            },
            "final_recommendation": final_recommendation,
            "confidence": f"{(vote_counts[final_recommendation] / len(recommendations) * 100):.0f}%",
            "summary": self._generate_summary(final_recommendation, weighted_result, pros_cons_result)
        }
    
    def _generate_summary(self, recommendation: str, weighted: Dict, pros_cons: Dict) -> str:
        """生成可读的总结"""
        summary = f"Based on comprehensive analysis, '{recommendation}' is recommended.\n\n"
        
        if "results" in weighted and recommendation in weighted["results"]:
            score = weighted["results"][recommendation]["total_score"]
            summary += f"• Weighted Score: {score}/10\n"
        
        if "results" in pros_cons and recommendation in pros_cons["results"]:
            pros = pros_cons["results"][recommendation]["pros"]
            cons = pros_cons["results"][recommendation]["cons"]
            summary += f"• Pros: {len(pros)} identified\n"
            summary += f"• Cons: {len(cons)} identified\n"
        
        return summary
```

---

### 📄 `backend/app/models/database_models.py`

```python
"""
数据库模型（预留）
当前使用 JSON 文件存储，未来可扩展为数据库
"""

from datetime import datetime
from typing import List, Optional
from pydantic import BaseModel


class Message(BaseModel):
    """消息模型"""
    role: str  # 'user' or 'assistant'
    content: str
    timestamp: str


class ChatSession(BaseModel):
    """聊天会话模型"""
    session_id: str
    created_at: str
    last_activity: str
    messages: List[Message] = []


class DecisionRequest(BaseModel):
    """决策请求模型"""
    description: str
    options: List[str]


class DecisionResponse(BaseModel):
    """决策响应模型"""
    recommendation: str
    readable_summary: str
    algorithm_analysis: Optional[dict] = None
```

---

## 3️⃣ 配置文件

### 📄 `vercel.json` (根目录)

```json
{
  "buildCommand": "cd frontend && npm install && npm run build",
  "outputDirectory": "frontend/build",
  "devCommand": "cd frontend && npm start",
  "installCommand": "cd frontend && npm install",
  "framework": null,
  "regions": ["sin1"]
}
```

---

### 📄 `docker-compose.yml`

```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - CHAT_STORAGE_DIR=/app/chat_data
    volumes:
      - ./backend/chat_data:/app/chat_data
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:8000
    depends_on:
      - backend
```

---

### 📄 `backend/Dockerfile`

```dockerfile
FROM python:3.10-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

### 📄 `frontend/Dockerfile`

```dockerfile
FROM node:16-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 3000

CMD ["npm", "start"]
```

---

## 4️⃣ 环境变量配置

### 📄 `backend/.env.example`

```env
# DeepSeek API Configuration
DEEPSEEK_API_KEY=sk-your-api-key-here

# Storage Configuration
CHAT_STORAGE_DIR=chat_data
MAX_HISTORY_MESSAGES=20

# CORS Configuration (comma-separated)
ALLOWED_ORIGINS=http://localhost:3000,https://your-app.vercel.app
```

---

### 📄 `frontend/.env.example`

```env
# Backend API URL
REACT_APP_API_URL=http://localhost:8000
```

---

## 📚 使用说明

### 本地开发启动

**后端：**
```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload
```

**前端：**
```bash
cd frontend
npm install
npm start
```

访问：http://localhost:3000

---

### Docker 启动

```bash
# 设置环境变量
export DEEPSEEK_API_KEY=your-api-key

# 启动所有服务
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down
```

---

### 生产部署

**前端部署到 Vercel：**
```bash
cd frontend
vercel --prod
```

**后端部署到 Railway/Render：**
1. 连接 GitHub 仓库
2. 设置 Root Directory: `backend`
3. 设置环境变量: `DEEPSEEK_API_KEY`
4. 部署命令: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`

---

## 🎯 核心功能

1. **智能聊天** - 基于 DeepSeek AI 的对话咨询
2. **决策分析** - 多算法综合分析决策选项
3. **聊天记录** - 完整的会话历史保存和查看
4. **响应式 UI** - 现代化的用户界面

---

## 📞 技术支持

- 前端技术：React 17, Create React App
- 后端技术：FastAPI, Python 3.10+
- AI 集成：DeepSeek API
- 部署平台：Vercel + Railway/Render

---

**文档版本：** 2.0  
**创建日期：** 2025-10-14  
**用途：** 提供给 GPT 分析、代码审查、问题诊断

---

**✨ 这是一个完整可运行的项目，包含所有核心代码！**

